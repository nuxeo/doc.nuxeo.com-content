---
title: Java Automation Client
review:
    comment: ''
    date: '2017-12-15'
    status: ok
notes: Documentation page used on Nuxeo Studio. Check with NOS team before deleting or moving.
labels:
    - lts2016-ok
    - automation
    - kleturc
    - link-update
    - client
    - community-links
    - java-client-component
    - lts2017-ok
toc: true
confluence:
    ajs-parent-page-title: Deprecated
    ajs-space-key: NXDOC
    ajs-space-name: Nuxeo Platform Developer Documentation
    canonical: Java+Automation+Client
    canonical_source: 'https://doc.nuxeo.com/display/NXDOC/Java+Automation+Client'
    page_id: '3343039'
    shortlink: vwIz
    shortlink_source: 'https://doc.nuxeo.com/x/vwIz'
    source_link: /display/NXDOC/Java+Automation+Client
tree_item_index: 200
history:
    -
        author: Manon Lumeau
        date: '2016-06-09 13:27'
        message: ''
        version: '79'
    -
        author: Vladimir Pasquier
        date: '2016-04-06 22:00'
        message: ''
        version: '78'
    -
        author: Vincent Dutat
        date: '2016-03-18 18:18'
        message: ''
        version: '77'
    -
        author: Ronan Daniellou
        date: '2016-02-18 10:42'
        message: Added block how to update multi-lines properties.
        version: '76'
    -
        author: Solen Guitter
        date: '2015-04-23 08:30'
        message: Format
        version: '75'
    -
        author: Maxime Hilaire
        date: '2015-04-22 18:26'
        message: ''
        version: '74'
    -
        author: Vladimir Pasquier
        date: '2015-04-13 15:43'
        message: ''
        version: '73'
    -
        author: Vladimir Pasquier
        date: '2015-02-04 12:22'
        message: Reverted from v. 70
        version: '72'
    -
        author: Vladimir Pasquier
        date: '2015-02-04 12:21'
        message: ''
        version: '71'
    -
        author: Solen Guitter
        date: '2014-12-05 19:13'
        message: Fix links to point to latest version
        version: '70'
    -
        author: Harlan Brown
        date: '2014-09-29 22:07'
        message: ''
        version: '69'
    -
        author: Solen Guitter
        date: '2013-11-13 14:44'
        message: ''
        version: '68'
    -
        author: Solen Guitter
        date: '2013-09-25 17:22'
        message: 'Updated links, formatted steps'
        version: '67'
    -
        author: Alain Escaffre
        date: '2013-09-17 03:35'
        message: ''
        version: '66'
    -
        author: Alain Escaffre
        date: '2013-09-17 03:35'
        message: ''
        version: '65'
    -
        author: Solen Guitter
        date: '2013-08-30 15:09'
        message: ''
        version: '64'
    -
        author: Solen Guitter
        date: '2013-07-31 11:52'
        message: ''
        version: '63'
    -
        author: Vladimir Pasquier
        date: '2013-07-09 17:53'
        message: ''
        version: '62'
    -
        author: Vladimir Pasquier
        date: '2013-06-27 15:20'
        message: ''
        version: '61'
    -
        author: Vladimir Pasquier
        date: '2013-06-24 17:01'
        message: ''
        version: '60'
    -
        author: Vladimir Pasquier
        date: '2013-06-24 12:44'
        message: ''
        version: '59'
    -
        author: Vladimir Pasquier
        date: '2013-06-21 17:52'
        message: ''
        version: '58'
    -
        author: Vladimir Pasquier
        date: '2013-06-20 18:29'
        message: ''
        version: '57'
    -
        author: Vladimir Pasquier
        date: '2013-06-20 16:54'
        message: ''
        version: '56'
    -
        author: Vladimir Pasquier
        date: '2013-06-20 16:54'
        message: ''
        version: '55'
    -
        author: Thibaud Arguillere
        date: '2013-06-20 16:51'
        message: ''
        version: '54'
    -
        author: Vladimir Pasquier
        date: '2013-06-20 16:49'
        message: ''
        version: '53'
    -
        author: Vladimir Pasquier
        date: '2013-06-20 15:46'
        message: ''
        version: '52'
    -
        author: Vladimir Pasquier
        date: '2013-06-20 15:37'
        message: ''
        version: '51'
    -
        author: Vladimir Pasquier
        date: '2013-06-20 15:36'
        message: ''
        version: '50'
    -
        author: Vladimir Pasquier
        date: '2013-06-20 15:03'
        message: ''
        version: '49'
    -
        author: Vladimir Pasquier
        date: '2013-06-20 14:58'
        message: ''
        version: '48'
    -
        author: Vladimir Pasquier
        date: '2013-06-20 12:15'
        message: ''
        version: '47'
    -
        author: Vladimir Pasquier
        date: '2013-06-19 18:14'
        message: ''
        version: '46'
    -
        author: Vladimir Pasquier
        date: '2013-06-19 18:02'
        message: ''
        version: '45'
    -
        author: Vladimir Pasquier
        date: '2013-06-19 18:01'
        message: ''
        version: '44'
    -
        author: Vladimir Pasquier
        date: '2013-06-19 17:48'
        message: ''
        version: '43'
    -
        author: Vladimir Pasquier
        date: '2013-06-19 17:46'
        message: ''
        version: '42'
    -
        author: Vladimir Pasquier
        date: '2013-06-19 16:10'
        message: ''
        version: '41'
    -
        author: Vladimir Pasquier
        date: '2013-06-19 15:54'
        message: ''
        version: '40'
    -
        author: Vladimir Pasquier
        date: '2013-06-19 15:42'
        message: ''
        version: '39'
    -
        author: Vladimir Pasquier
        date: '2013-06-19 15:40'
        message: ''
        version: '38'
    -
        author: Vladimir Pasquier
        date: '2013-06-19 15:38'
        message: ''
        version: '37'
    -
        author: Solen Guitter
        date: '2013-06-19 15:34'
        message: Added TOC
        version: '36'
    -
        author: Vladimir Pasquier
        date: '2013-06-19 15:25'
        message: ''
        version: '35'
    -
        author: Vladimir Pasquier
        date: '2013-06-19 15:08'
        message: ''
        version: '34'
    -
        author: Vladimir Pasquier
        date: '2013-06-19 12:38'
        message: ''
        version: '33'
    -
        author: Brendan Coveney
        date: '2013-05-29 22:19'
        message: ''
        version: '32'
    -
        author: Antoine Taillefer
        date: '2012-11-15 18:11'
        message: ''
        version: '31'
    -
        author: Antoine Taillefer
        date: '2012-11-15 17:52'
        message: ''
        version: '30'
    -
        author: Antoine Taillefer
        date: '2012-11-15 17:00'
        message: ''
        version: '29'
    -
        author: Julien Carsique
        date: '2012-05-11 14:32'
        message: Migrated to Confluence 4.0
        version: '28'
    -
        author: Julien Carsique
        date: '2012-05-11 14:32'
        message: ''
        version: '27'
    -
        author: Julien Carsique
        date: '2012-03-14 18:25'
        message: ''
        version: '26'
    -
        author: Stéphane Lacoin
        date: '2012-03-14 14:30'
        message: ''
        version: '25'
    -
        author: Olivier Grisel
        date: '2012-02-01 11:25'
        message: fix automation client download link
        version: '24'
    -
        author: Solen Guitter
        date: '2011-11-07 18:29'
        message: ''
        version: '23'
    -
        author: Julien Carsique
        date: '2011-02-03 11:55'
        message: ''
        version: '22'
    -
        author: Julien Carsique
        date: '2011-02-03 11:53'
        message: 'Add download link from http://maven.nuxeo.org/'
        version: '21'
    -
        author: Stéphane Lacoin
        date: '2010-11-27 21:26'
        message: ''
        version: '20'
    -
        author: Stéphane Lacoin
        date: '2010-11-27 20:52'
        message: ''
        version: '19'
    -
        author: Stéphane Lacoin
        date: '2010-11-27 20:51'
        message: ''
        version: '18'
    -
        author: Stéfane Fermigier
        date: '2010-08-03 15:55'
        message: ''
        version: '17'
    -
        author: Stéfane Fermigier
        date: '2010-08-03 15:54'
        message: ''
        version: '16'
    -
        author: Stéfane Fermigier
        date: '2010-08-03 15:54'
        message: ''
        version: '15'
    -
        author: Stéfane Fermigier
        date: '2010-08-03 15:53'
        message: ''
        version: '14'
    -
        author: Bogdan Stefanescu
        date: '2010-07-29 17:51'
        message: ''
        version: '13'
    -
        author: Bogdan Stefanescu
        date: '2010-07-19 17:06'
        message: ''
        version: '12'
    -
        author: Bogdan Stefanescu
        date: '2010-07-19 17:03'
        message: ''
        version: '11'
    -
        author: Bogdan Stefanescu
        date: '2010-07-19 16:42'
        message: ''
        version: '10'
    -
        author: Bogdan Stefanescu
        date: '2010-07-19 16:25'
        message: ''
        version: '9'
    -
        author: Bogdan Stefanescu
        date: '2010-07-19 16:23'
        message: ''
        version: '8'
    -
        author: Bogdan Stefanescu
        date: '2010-07-19 16:21'
        message: ''
        version: '7'
    -
        author: Bogdan Stefanescu
        date: '2010-07-19 15:57'
        message: ''
        version: '6'
    -
        author: Bogdan Stefanescu
        date: '2010-07-19 15:55'
        message: ''
        version: '5'
    -
        author: Bogdan Stefanescu
        date: '2010-07-19 15:54'
        message: ''
        version: '4'
    -
        author: Bogdan Stefanescu
        date: '2010-07-19 15:53'
        message: ''
        version: '3'
    -
        author: Bogdan Stefanescu
        date: '2010-07-19 15:13'
        message: ''
        version: '2'
    -
        author: Bogdan Stefanescu
        date: '2010-07-19 11:56'
        message: ''
        version: '1'

---
{{#> callout type='warning' }}

Java Automation Client has been deprecated for Nuxeo LTS 2016\. Please use [Nuxeo Java Client](http://nuxeo.github.io/nuxeo-java-client/).

{{/callout}}

{{! excerpt}}

Nuxeo provides a high level client implementation for Java programmers: Nuxeo Automation Client API simplifies your task since it handles all the protocol level details.

{{! /excerpt}}

## Dependencies

{{#> callout type='note' }}

*   This documentation applies for `nuxeo-automation-client` versions greater or equal to `5.4`.
*   The Nuxeo Automation Client is also available with all dependencies included (JAR shaded - nuxeo-automation-XX-jar-with-dependencies)

{{/callout}}

To use the Java Automation client you need to put a dependency on the following Maven artifact:

```xml
<dependency>
    <groupId>org.nuxeo.ecm.automation</groupId>
    <artifactId>nuxeo-automation-client</artifactId>
    <version>...</version>
</dependency>

```

{{#> panel type='code' heading='with dependencies'}}

```xml
<dependency>
    <groupId>org.nuxeo.ecm.automation</groupId>
    <artifactId>nuxeo-automation-client</artifactId>
    <version>...</version>
    <classifier>jar-with-dependencies</classifier>
 </dependency>

```

{{/panel}}

For a direct download, see [https://maven.nuxeo.org/](https://maven.nuxeo.org/nexus/index.html#nexus-search;quick%7Enuxeo-automation-client).

The client library depends on:

*   `com.fasterxml.jackson.core:jackson-*`, `net.sf.ezmorph:ezmorph` - for JSON support
*   `org.codehaus.jackson:jackson-core-asl`
*   `org.codehaus.jackson:jackson-mapper-asl`.
*   `org.apache.httpcomponents:httpcore`, `org.apache.httpcomponents:httpclient` - for HTTP support
*   `javax.mail` - for multipart content support

## Automation Client API

Let's take an example and execute the `SELECT * FROM Document` query against a remote Automation server:

```java
import org.nuxeo.ecm.automation.client.jaxrs.impl.HttpAutomationClient;
import org.nuxeo.ecm.automation.client.model.Documents;
import org.nuxeo.ecm.automation.client.Session;

public static void main(String[] args) throws Exception {
    HttpAutomationClient client = new HttpAutomationClient(
           "http://localhost:8080/nuxeo/site/automation");

    Session session = client.getSession("Administrator", "Administrator");
    Documents docs = (Documents) session.newRequest("Repository.Query")
                                        .set("query", "SELECT * FROM Document")
                                        .execute();
    System.out.println(docs);

    client.shutdown();
}

```

You can see the code above has three distinctive parts:

1.  Opening a connection.
2.  Invoking remote operations.
3.  Destroying the client.

### Opening a Connection

1.  Before using the Automation client you should first create a new client that is connecting to a remote address you can specify through the constructor URL argument. As the remote server URL you should use the URL of the Automation service.

    ```java
    // create a new client instance
    HttpAutomationClient client = new HttpAutomationClient("http://localhost:8080/nuxeo/site/automation");
    ```

    No connection to the remote service is made at this step. The Automation service definition will be downloaded the first time you create a session.

    A local registry of available operations is created from the service definition sent by the server.

    {{#> callout type='info' }}

    The local registry of operations contains all operations on the server - but you can invoke only operations that are accessible to your user - otherwise a 404 (operation not found) will be sent by the server.

    {{/callout}}

    Once you created a client instance you **must** create a new session to be able to start to invoke remote operations. When creating a session you should pass the credentials to be used to authenticate against the server.

2.  So you create a new session by calling:

    ```java
    import org.nuxeo.ecm.automation.client.Session;

    Session session = client.getSession("Administrator", "Administrator");
    ```

    This will authenticate you onto the server using the basic authentication scheme.

    If needed, you can use another authentication scheme by setting an interceptor.

    ```java
    client.setInterceptor(new PortalSSOAuthInterceptor("nuxeo5secretkey", "Administrator"));
    Session session = client.getSession();
    ```

    {{#> callout type='note' }}

    Make sure to not open a session each time you call an operation, otherwise you will have performances issues.

    We recommend to open the session once before calling any operation, like during application startup or when the user needs to authenticate. Then you may close it when the user logout or during application shutdown.

    {{/callout}}

### Invoking Remote Operations

Using a session you can now invoke remote operations.

1.  To create a new invocation request you should pass in the right operation or chain ID.

    ```java
    OperationRequest request = session.newRequest("Repository.Query");

    ```

2.  Then populate the request with all the required arguments.

    ```java
    request.set("query", "SELECT * FROM Document");

    ```

    You can see in the example that you have to specify only the `query` argument. If you have more arguments, call the `set` method in turn for each of these arguments. If you need to specify execution context parameters you can use `request.setContextProperty` method. On the same principle, if you need to specify custom HTTP headers you can use the `request.setHeader` method.

3.  After having filled all the required request information you can execute the request by calling the execute method.

    ```java
    Object result = request.execute();

    ```

    {{#> callout type='info' heading='The client API provides both synchronous and asynchronous execution'}}

    For an asynchronous execution you can make a call to the `execute(AsyncCallback<Object> cb)` method.

    Beware that you can set the timeout in milliseconds for the wait of the aynchronous thread pool termination at client shutdown by passing it to the `HttpAutomationClient` constructor: `public HttpAutomationClient(String url, long httpConnectionTimeout, long asyncAwaitTerminationTimeout)`.

    Default value is 2 seconds. If you don't use any asynchronous call you can set this timeout to 0 in order not to wait at client shutdown.

    {{/callout}} {{#> callout type='info' heading='Setting the HTTP connection timeout'}}

    You can set a timeout in milliseconds for the HTTP connection in order to avoid an infinite wait in case of a network cut or if the Nuxeo server is not responding.

    Just pass it to the `HttpAutomationClient` constructor: `public HttpAutomationClient(String url, long httpConnectionTimeout, long asyncAwaitTerminationTimeout)`.

    Default value is 0 = no timeout.

    {{/callout}}

    Executing a request will either throw an exception or return the result. The result object can be null if the operation has no result (i.e. a void operation) - otherwise a Java object is returned. The JSON result is automatically decoded into a proper Java object. The following objects are supported as operation results:

    *   Document - a document object
    *   Documents - a list of documents
    *   Blob - a file
    *   Blobs - a file list

    In case the operation invocation fails - an exception described by a JSON entity will be sent by the server and the client will automatically decode it into a real Java exception derived from `org.nuxeo.ecm.automation.client.jaxrs.RemoteException`.

    {{#> callout type='info' }}

    Before sending the request the client will check the operation arguments to see if they match the operation definition and will throw an exception if some required argument is missing. The request will be sent only after validation successfully completes.

    {{/callout}}

The query example is pretty simply. The query operation doesn't need an input object to be executed. (i.e. the input can be null). But most operations require an input. In that case you must call `request.setInput` method to set the input. We will see more about this in the following examples.

If you prefer a most compact notation you can use the [fluent interface](http://en.wikipedia.org/wiki/Fluent_interface) way of calling methods:

```java
Object result = session.newRequest("OperationId").set("var1", "val1").set("var2", "val2").execute();

```

### Destroying the Client

When you are done with the client you must call the `client.disconnect` method to free any resource held by the client. Usually this is done only once when the client application is shutdown. Creating new client instances and destroying them may be costly so you should use a singleton client instance and use it from different threads (which is safe).

{{#> callout type='info' }}

If you need different logins then create one session per login. A session is thread safe.

{{/callout}}

## Create Read Update Delete

In this example we assume we already have a session instance.

Here is an example with [Document.Create](http://explorer.nuxeo.org/nuxeo/site/distribution/latest/viewOperation/Document.Create), [Document.Update](http://explorer.nuxeo.org/nuxeo/site/distribution/latest/viewOperation/Document.Update), [Document.Delete](http://explorer.nuxeo.org/nuxeo/site/distribution/latest/viewOperation/Document.Delete), [Document.Fetch](http://explorer.nuxeo.org/nuxeo/site/distribution/latest/viewOperation/Document.Fetch) operations.

{{#> callout type='info' }}

You can see [The Automation Client Service Adapter section](#automation-client-service-adapter) to know how CRUD operations are wrapped into DocumentService adapter and how to use it.

{{/callout}}

```java
import org.nuxeo.ecm.automation.client.model.Document;
import org.nuxeo.ecm.automation.client.Session; 
import org.nuxeo.ecm.automation.client.Constants;
import org.nuxeo.ecm.automation.client.model.IdRef;

// Fetch the root of Nuxeo repository
Document root = (Document) session.newRequest("Document.Fetch").set("value", "/").execute();

// Instantiate a new Document with the simple constructor
Document document = new Document("myDocument", "File");
document.set("dc:title", "My File");
document.set("dc:description", "My Description");

// Create a document of File type by setting the parameter 'properties' with String metadata values delimited by comma ','
document = (Document) session.newRequest("Document.Create")
                             .setHeader(Constants.HEADER_NX_SCHEMAS, "*")
                             .setInput(root)
                             .set("type", document.getType())
                             .set("name", document.getId())
                             .set("properties", document)
                             .execute();

// Set another title to update
document.set("dc:title", "New Title");

// Update the document
document = (Document) session.newRequest("Document.Update")
                             .setInput(document)
                             .set("properties", document)
                             .execute();

// Delete the document
session.newRequest("Document.Delete").setInput(document).execute();
```

Operations examples above fetch the document with common properties: `common`, `dublincore`, `file`. If you wish to fetch all properties or a specific schema, you can do as this following example:

```java
import org.nuxeo.ecm.automation.client.model.Document;
import org.nuxeo.ecm.automation.client.Session;
import org.nuxeo.ecm.automation.client.Constants;
import org.nuxeo.ecm.automation.client.model.IdRef;

Document document = new Document("myDocument", "File");

// For all operations -> use setHeader method to specify specific schemas or every ones (*)

Document root = (Document) session.newRequest("Document.Fetch")
                                  .setHeader(Constants.HEADER_NX_SCHEMAS, "*")
                                  .set("value", "/")
                                  .execute();

document = (Document) session.newRequest("Document.Create")
                             .setHeader(Constants.HEADER_NX_SCHEMAS, "dublincore,blog")
                             .setInput(root)
                             .set("type", document.getType())
                             .set("name", document.getId())
                             .set("properties", document)
                             .execute();

document = (Document) session.newRequest("Document.Update")
                             .setHeader(Constants.HEADER_NX_SCHEMAS, "dublincore,blog")
                             .setInput(document)
                             .set("properties", document)
                             .execute();
```

{{#> callout type='info' }}

You can fetch all updated properties during the session with the following method of the document:

```java
// Fetch the dirty properties (updated values) from the document
PropertyMap dirties = document.getDirties();
```

To see complex properties example and the use of `propertyMap`, see [the Managing Complex Properties section](#managing-complex-properties).

{{/callout}}

## Updating Multi-line String Properties

Multi-lines values lines must end with `\\`. For example:

```java
document.set("mySchema:myProperty", "line1\\\nline2");
documentService.update(document);
```

## Managing Blobs

In this example we assume we already have a session instance.

The example will create a new File document into the root _"/"_ document and then will upload a file into it. Finally we will download back this file.

1.  Get the root document and create a new File document at location `/myfile.`

    ```java
    import org.nuxeo.ecm.automation.client.model.Document;
    import org.nuxeo.ecm.automation.client.Session; 

    // get the root
    Document root = (Document) session.newRequest("Document.Fetch").set("value", "/").execute();

    // create a file document
    session.newRequest("Document.Create")
           .setInput(root)
           .set("type", "File")
           .set("name", "myfile")
           .set("properties", "dc:title=My File")
           .execute();
    ```

    {{#> callout type='info' }}

    Note the usage of `setInput()` method. This is to specify that the create operation must be executed in the context of the root document - so the new document will be created under the root document. Also you can notice that the input object is a Document instance.

    {{/callout}}
2.  Now get the file to upload and put it into the newly created document.

    ```java
    File file = getTheFileToUpload();
    FileBlob fb = new FileBlob(file);
    fb.setMimeType("text/xml");
    // uploading a file will return null since we used HEADER_NX_VOIDOP
    session.newRequest("Blob.Attach")
           .setHeader(Constants.HEADER_NX_VOIDOP, "true")
           .setInput(fb)
           .set("document", "/myfile")
           .execute();
    ```

    The last `execute` call will return `null` since the `HEADER_NX_VOIDOP` header was used. This is to avoid receiving back from the server the blob we just uploaded.

    {{#> callout type='info' }}

    Note that to upload a file we need to use a `Blob` object that wrap the file to upload.

    {{/callout}}
3.  Now get the the file document where the blob was uploaded.
4.  Then retrieve the blob remote URL from the document metadata. We can use this URL to download the blob.

    ```java
    import org.nuxeo.ecm.automation.client.model.Document;
    import org.nuxeo.ecm.automation.client.Session;
    import org.nuxeo.ecm.automation.client.Constants;

    // get the file document where blob was attached
    Document doc = (Document) session.newRequest("Document.Fetch")
                                     .setHeader(Constants.HEADER_NX_SCHEMAS, "*")
                                     .set("value", "/myfile")
                                     .execute();
    // get the file content property
    PropertyMap map = doc.getProperties().getMap("file:content");
    // get the data URL
    String path = map.getString("data");
    ```

    You can see we used the special `HEADER_NX_SCHEMAS` header to specify we want all properties of the document to be included in the response.

5.  Now download the file located on the server under the `path` we retrieved from the document properties:

    ```java
    // download the file from its remote location
    blob = (FileBlob) session.getFile(path);
    // ... do something with the file
    // at the end delete the temporary file
    blob.getFile().delete();
    ```

    We can do the same by invoking the `Blob.Get` operation.

    ```java
    // now test the GetBlob operation on the same blob
    blob = (FileBlob) session.newRequest("Blob.Get")
                             .setInput(doc)
                             .set("xpath", "file:content")
                             .execute();
    // ... do something with the file
    // at the end delete the temporary file
    blob.getFile().delete();
    ```

## {{> anchor 'managing-complex-properties'}}Managing Complex Properties

Complex properties can have different levels complexity. This part of the documentation is about managing them with Automation Client API using JSON format.

Let's see a complex property schema example:

```xml
<?xml version="1.0"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
           xmlns:mc="http://nuxeo.org/schemas/dataset/"
           elementFormDefault="qualified"
           targetNamespace="http://nuxeo.org/schemas/dataset/">
...
    <xs:complexType name="field">
        <xs:sequence>
            <xs:element name="name" type="xs:string"/>
            <xs:element name="description" type="xs:string"/>
            <xs:element name="fieldType" type="mc:fieldType">

            </xs:element>
            <xs:element name="columnName" type="xs:string"/>
            <xs:element name="sqlTypeHint" type="xs:string"/>

            <xs:element name="roles">
                <xs:complexType>
                    <xs:sequence>
                        <xs:element name="role" type="mc:roleType" minOccurs="0" maxOccurs="unbounded"/>
                    </xs:sequence>
                </xs:complexType>
            </xs:element>
        </xs:sequence>
    </xs:complexType>
...
</xs:schema>
```

Let's see a JSON example of these complex property values:

{{#> panel type='code' heading='creation.json'}}

```json
[
    {
        "fieldType": "string",
        "description": "desc field0",
        "roles": [
            "Decision",
            "Score"
        ],
        "name": "field0",
        "columnName": "col0",
        "sqlTypeHint": "whatever"
    },
    {
        "fieldType": "string",
        "description": "desc field1",
        "roles": [
            "Decision",
            "Score"
        ],
        "name": "field1",
        "columnName": "col1",
        "sqlTypeHint": "whatever"
    },
    {
        "fieldType": "string",
        "description": "desc field2",
        "roles": [
            "Decision",
            "Score"
        ],
        "name": "field2",
        "columnName": "col2",
        "sqlTypeHint": "whatever"
    },
    {
        "fieldType": "string",
        "description": "desc field3",
        "roles": [
            "Decision",
            "Score"
        ],
        "name": "field3",
        "columnName": "col3",
        "sqlTypeHint": "whatever"
    },
    {
        "fieldType": "string",
        "description": "desc field4",
        "roles": [
            "Decision",
            "Score"
        ],
        "name": "field4",
        "columnName": "col4",
        "sqlTypeHint": "whatever"
    }
]

```

{{/panel}}

Finally updating a document with the JSON values into its related metadata looks like this.

```java
// Fetch the document
Document document = (Document) session.newRequest(DocumentService.GetDocumentChild)
                                      .setInput(new PathRef("/"))
                                      .set("name", "testDoc").execute();

// Send the fields representation as json

// Read the json file
File fieldAsJsonFile = FileUtils.getResourceFileFromContext("creation.json");
String fieldsDataAsJSon = org.apache.commons.io.FileUtils.readFileToString(fieldAsJsonFile, Charsets.UTF_8);

// Don't forget to replace CRLF or LF
fieldsDataAsJSon = fieldsDataAsJSon.replaceAll("\n", "");
fieldsDataAsJSon = fieldsDataAsJSon.replaceAll("\r", "");

// Set the json values to the related metadata
document.set("ds:fields", fieldsDataAsJSon);

// Document Update
session.newRequest(UpdateDocument.ID).setInput(document).set("properties", document).execute();
```

## {{> anchor 'managing-business-objects'}}Managing Business Objects

It is possible to manage business objects (Plain Old Java Object client side for mapping the [Nuxeo Document Model Adapter](http://explorer.nuxeo.org/nuxeo/site/distribution/latest/viewExtensionPoint/org.nuxeo.ecm.core.api.DocumentAdapterService--adapters) ([Documentation]({{page page='repository-concepts#documentmodel-adapter'}})) server side).

Why manage business object? To manipulate business object to avoid _Nuxeo Document_ manipulation on client side:

{{#> callout type='info' }}

<pre>pull : BusinessObject (POJO) <----JSON---- DocumentModelAdapter <---- DocumentModel

push : BusinessObject (POJO) -----JSON---> DocumentModelAdapter ----> DocumentModel</pre>

{{/callout}}

Let's see an example.

1.  Create a [Nuxeo Document Model Adapter](http://explorer.nuxeo.org/nuxeo/site/distribution/latest/viewExtensionPoint/org.nuxeo.ecm.core.api.DocumentAdapterService--adapters) registered on server side and which should extend the [`BusinessAdapter`](https://github.com/nuxeo/nuxeo/blob/master/nuxeo-features/nuxeo-automation/nuxeo-automation-core/src/main/java/org/nuxeo/ecm/automation/core/operations/business/adapter/BusinessAdapter.java) class:

    ```java
    import org.nuxeo.ecm.automation.core.operations.business.adapter.BusinessAdapter;
    import org.codehaus.jackson.annotate.JsonCreator;
    import org.codehaus.jackson.annotate.JsonProperty;
    import org.nuxeo.ecm.core.api.DocumentModel;

     /**
     * Document Model Adapter example server side
     */
    public class BusinessBeanAdapter extends BusinessAdapter {

        private static final Log log = LogFactory.getLog(BusinessBeanAdapter.class);

        /**
         * Default constructor is needed for jackson mapping
         */
        public BusinessBeanAdapter() {
            super();
        }

        public BusinessBeanAdapter(DocumentModel documentModel) {
            super(documentModel);
        }

        public String getTitle() {
            try {
                return (String) getDocument().getPropertyValue("dc:title");
            } catch (ClientException e) {
                log.error("cannot get property title", e);
            }
            return null;
        }

        public void setTitle(String value) {
            try {
                getDocument().setPropertyValue("dc:title", value);
            } catch (ClientException e) {
                log.error("cannot set property title", e);
            }
        }

        public String getDescription() {
            try {
                return (String) getDocument().getPropertyValue("dc:description");
            } catch (ClientException e) {
                log.error("cannot get description property", e);
            }
            return null;
        }

        public void setDescription(String value) {
            try {
                getDocument().setPropertyValue("dc:description", value);
            } catch (ClientException e) {
                log.error("cannot set description property", e);
            }
        }
    }

    ```

2.  Declare a POJO on client side as following:

    ```java
    import org.nuxeo.ecm.automation.client.annotations.EntityType;

    //Automation client File pojo example annotated with EntityType setting the adapter server side built previously (just the simple name)
    @EntityType("BusinessBeanAdapter")
    public class BusinessBean {
        protected String title;
        protected String description;
        protected String id;
        protected String type;

        /**
        * this default contructor is mandatory for jackson mapping on the nuxeo server side
        **/
        public BusinessBean() {
        }

        public BusinessBean(String title, String description, String type) {
            this.title = title;
            this.type = type;
            this.description = description;
        }
        public String getTitle() {
            return title;
        }
        public void setTitle(String title) {
            this.title = title;
        }
        public String getDescription() {
            return description;
        }
        public void setDescription(String description) {
            this.description = description;
        }
        public String getId() {
            return id;
        }
        public void setId(String id) {
            this.id = id;
        }
       public String getType() {
            return type;
        }
        public void setType(String type) {
            this.type = type;
        }
     }

    ```

    {{#> callout type='note' }}

    We assume that the POJO client side stub is similar to the document model adapter stub server side.

    {{/callout}}

    So now we have on client side a POJO `BusinessBean` and on server side a Document Model Adapter `BusinessBeanAdapter`.

    We are going to use two operations for creating/updating process:

    *   [`Business.BusinessCreateOperation`](http://explorer.nuxeo.org/nuxeo/site/distribution/latest/viewOperation/Business.BusinessCreateOperation)
    *   [`Business.BusinessUpdateOperation`](http://explorer.nuxeo.org/nuxeo/site/distribution/latest/viewOperation/Business.BusinessUpdateOperation)
    {{#> callout type='info' }}
    See [the Automation Client Service Adapter section](#automation-client-service-adapter) to know how Business operations are wrapped into `BusinessService` adapter and how to use it.
    {{/callout}}

3.  Let's see how to map them directly using these operations:

    ```java
    import org.nuxeo.ecm.automation.client.jaxrs.spi.JsonMarshalling;

    // Let's instiante a BusinessBean 'File':
    BusinessBean file = new BusinessBean("File", "File description", "File");

    // BusinessBean 'File' Marshaller has to be registered in Automation Client following this way:
    JsonMarshalling.addMarshaller(PojoMarshaller.forClass(file.getClass()));

    // Injecting the BusinessBean 'File' into the operation BusinessCreateOperation let you create a document server side.
    file = (BusinessBean) session.newRequest("Operation.BusinessCreateOperation")
                                 .setInput(file)
                                 .set("name", file.getTitle())
                                 .set("parentPath","/")
                                 .execute();

    // Update document on server (pojo <-> adapter update) using BusinessUpdateOperation
    file.setTitle("Title Updated");
    file = (BusinessBean) session.newRequest("Operation.BusinessUpdateOperation")
                                 .setInput(file)
                                 .execute();

    ```

## GitHub Nuxeo Automation Tests

Here is the complete code of the example. For more examples, see the unit tests in [`nuxeo-automation-test`](https://github.com/nuxeo/nuxeo/tree/master/nuxeo-features/nuxeo-automation/nuxeo-automation-test/src/test/java/org/nuxeo/ecm/automation/server/test) project.

## {{> anchor 'automation-client-service-adapter'}}Automation Client Service Adapter

##### Default Service Adapter

Nuxeo Automation Client provides an "Adapter Service" to encapsulate business logic.

Default services provided:

*   [`DocumentService`](http://community.nuxeo.com/api/nuxeo/latest/javadoc/org/nuxeo/ecm/automation/client/adapters/DocumentService.html) - ([Class on GitHub](https://github.com/nuxeo/nuxeo/blob/master/nuxeo-features/nuxeo-automation/nuxeo-automation-client/src/main/java/org/nuxeo/ecm/automation/client/adapters/DocumentService.java)): This API provides access to basic operation like CRUD, lock, version...
*   [`BusinessService`](http://community.nuxeo.com/api/nuxeo/latest/javadoc/org/nuxeo/ecm/automation/client/adapters/BusinessService.html) ([Class on GitHub](https://github.com/nuxeo/nuxeo/blob/master/nuxeo-features/nuxeo-automation/nuxeo-automation-client/src/main/java/org/nuxeo/ecm/automation/client/adapters/BusinessService.java)): This API provides access to Business Operations.

![]({{file name='AdapterService.png'}} ?w=838,h=219,border=true)

_[Powered by yFiles](http://www.yworks.com)_

##### DocumentService Usage

Here is an example of using `DocumentService` API:

```java
import org.nuxeo.ecm.automation.client.model.Document;
import org.nuxeo.ecm.automation.client.adapters.DocumentService;
import org.nuxeo.ecm.automation.client.Session;

// Test document creation
Document myDocument = new Document("myfolder2", "Folder");
myDocument.set("dc:title", "My Test Folder");
myDocument.set("dc:description", "test");
myDocument.set("dc:subjects", "a,b,c\\,d");

DocumentService documentService = session.getAdapter(DocumentService.class);

// Here is the way to create a document by using DocumentService
// Note you can put in first parameter, the Id or Path of the parent document
myDocument = documentService.createDocument(DocumentParent.getId(), myDocument);

// Fetch the document with its dublincore properties
// You can add several schemas like ...(myDocument, "dublincore", "yourSchema");
myDocument = documentService.getDocument(myDocument, "dublincore");

// Update the document title
myDocument.set("dc:title", "New Title");
documentService.update(myDocument);

// Fetch the document with all its properties (all schemas)
myDocument = documentService.getDocument(folder, "*");
```

##### BusinessService Usage

Here is an example of using `BusinessService` API (this example is the same previous one with [Business Objects](#managing-business-objects) but this time using `BusinessService`):

```java
import org.nuxeo.ecm.automation.client.adapters.BusinessService;
import org.nuxeo.ecm.automation.client.Session;

// A simple custom POJO client side
BusinessBean file = new BusinessBean("File", "File description", "File");

// Fetching the business service adapter
BusinessService<BusinessBean> businessService = session.getAdapter(BusinessService.class);

// Create server side injecting the POJO to the service method create
file = (BusinessBean) businessService.create(file, file.getTitle(), "/");

// Process to update with POJO
file.setTitle("Update");
file = (BusinessBean) businessService.update(file);
```

##### Contributing a New Custom Service Adapter

You can contribute your own adapter service by Java to encapsulate your own business logic.

To achieve this registration, you have to provide an adapter service factory that is going to instantiate your adapter. You can find an example of factory for the [`DocumentService`](http://community.nuxeo.com/api/nuxeo/latest/javadoc/org/nuxeo/ecm/automation/client/adapters/DocumentService.html) class: [`DocumentServiceFactory`](http://community.nuxeo.com/api/nuxeo/latest/javadoc/org/nuxeo/ecm/automation/client/adapters/DocumentServiceFactory.html) ([source code on GitHub](https://github.com/nuxeo/nuxeo/blob/master/nuxeo-features/nuxeo-automation/nuxeo-automation-client/src/main/java/org/nuxeo/ecm/automation/client/adapters/DocumentServiceFactory.java)).

Here is an example of registration:

```
HttpAutomationClient client = new HttpAutomationClient("http://localhost:8080/nuxeo/site/automation");

// Register you own service factory
client.registerAdapter(new MyServiceFactory());

// And then retrieve your custom adapter service
MyService myService = session.getAdapter(MyService.class);
```

## Automation Client in OSGi Environment

Nuxeo Automation Client is OSGi compliant.

##### Example to Get Automation Client in an OSGi Environment

(Here we're using [Apache Felix Framework](http://felix.apache.org/))

```
import org.osgi.framework.BundleContext;
import org.osgi.framework.ServiceReference;
import javax.inject.Inject;

@Inject
BundleContext bundleContext;

// Example with Felix ServiceReference
ServiceReference serviceReference = bc.getServiceReference(AutomationClientFactory.class.getName());

// Fetch the Automation Client Factory
AutomationClientFactory factory = (AutomationClientFactory) bundleContext.getService(serviceReference);

// Get the Automation Client with given URL of you server
AutomationClient client = factory.getClient(new URL("http://localhost:8080/nuxeo/site/automation"));

// Get client with http connection timeout as parameter in milliseconds
client = factory.getClient(new URL("http://localhost:8080/nuxeo/site/automation"), 3600);
```

{{#> panel type='code' heading='MANIFEST.MF information declared into the Automation Client bundle'}}

```
Bundle-SymbolicName: org.nuxeo.ecm.automation.client

Bundle-Activator: org.nuxeo.ecm.automation.client.jaxrs.impl.AutomationClientActivator

Export-Package: org.nuxeo.ecm.automation.client.adapters;version="0.0.
 0.qualifier",org.nuxeo.ecm.automation.client;version="0.0.0.qualifier
 ",org.nuxeo.ecm.automation.client.model;version="0.0.0.qualifier"

Import-Package: javax.activation,javax.mail;version="1.4",javax.mail.i
 nternet;version="1.4",org.apache.commons.lang;version="2.6",org.apach
 e.commons.logging;version="1.1",org.apache.http;version="4.2",org.apa
 che.http.auth;version="4.2",org.apache.http.client;version="4.2",org.
 apache.http.client.methods;version="4.2",org.apache.http.conn;version
 ="4.2",org.apache.http.entity;version="4.2",org.apache.http.impl.clie
 nt;version="4.2",org.apache.http.impl.conn.tsccm;version="4.2",org.ap
 ache.http.params;version="4.2",org.apache.http.protocol;version="4.2"
 ,org.codehaus.jackson;version="1.8",org.codehaus.jackson.map;version=
 "1.8",org.codehaus.jackson.map.annotate;version="1.8",org.codehaus.ja
 ckson.map.deser;version="1.8",org.codehaus.jackson.map.introspect;ver
 sion="1.8",org.codehaus.jackson.map.module;version="1.8",org.codehaus
 .jackson.map.type;version="1.8",org.codehaus.jackson.type;version="1.
 8",org.nuxeo.ecm.automation.client;version="0.0",org.nuxeo.ecm.automa
 tion.client.adapters;version="0.0",org.nuxeo.ecm.automation.client.mo
 del;version="0.0",org.osgi.framework;version="1.5"
```

{{/panel}}
