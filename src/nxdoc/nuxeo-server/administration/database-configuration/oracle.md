---
title: Oracle
review:
    comment: ''
    date: '2017-12-15'
    status: ok
labels:
    - lts2016-ok
    - database
    - kleturc
    - oracle
    - multiexcerpt-include
    - lts2017-ok
toc: true
confluence:
    ajs-parent-page-id: '3342340'
    ajs-parent-page-title: Database Configuration
    ajs-space-key: NXDOC
    ajs-space-name: Nuxeo Platform Developer Documentation
    canonical: Oracle
    canonical_source: 'https://doc.nuxeo.com/display/NXDOC/Oracle'
    page_id: '3867083'
    shortlink: ywE7
    shortlink_source: 'https://doc.nuxeo.com/x/ywE7'
    source_link: /display/NXDOC/Oracle
tree_item_index: 200
version_override:
    LTS 2015: 710/admindoc/oracle
    '6.0': 60/admindoc/configuring-oracle
    '5.8': 58/admindoc/configuring-oracle
history:
    -
        author: Manon Lumeau
        date: '2016-08-02 15:56'
        message: ''
        version: '55'
    -
        author: Solen Guitter
        date: '2016-05-13 14:41'
        message: ''
        version: '54'
    -
        author: Florent Guillaume
        date: '2015-12-22 13:32'
        message: ''
        version: '53'
    -
        author: Florent Guillaume
        date: '2015-12-09 14:11'
        message: removed v$session grant now unneeded
        version: '52'
    -
        author: Florent Guillaume
        date: '2015-12-09 14:03'
        message: ''
        version: '51'
    -
        author: Alain Escaffre
        date: '2015-12-04 13:43'
        message: ''
        version: '50'
    -
        author: Solen Guitter
        date: '2015-03-25 10:05'
        message: ''
        version: '49'
    -
        author: Solen Guitter
        date: '2014-12-10 11:15'
        message: ''
        version: '48'
    -
        author: Solen Guitter
        date: '2014-12-10 11:01'
        message: typos and terminology
        version: '47'
    -
        author: Thierry Martins
        date: '2014-12-09 19:51'
        message: Add DB_BLOCK_SIZE configuration
        version: '46'
    -
        author: Florent Guillaume
        date: '2014-10-28 11:25'
        message: ''
        version: '45'
    -
        author: Solen Guitter
        date: '2014-10-13 17:36'
        message: Updated supported versions for 6.0
        version: '44'
    -
        author: Solen Guitter
        date: '2014-08-25 14:44'
        message: Remove 5.3 reference
        version: '43'
    -
        author: Solen Guitter
        date: '2014-07-24 15:39'
        message: Moved limitations from independent page into Oracle page
        version: '42'
    -
        author: Solen Guitter
        date: '2014-02-17 10:18'
        message: ''
        version: '41'
    -
        author: Thierry Martins
        date: '2014-02-14 17:00'
        message: DB with no GRANT
        version: '40'
    -
        author: Florent Guillaume
        date: '2013-12-09 15:11'
        message: ''
        version: '39'
    -
        author: Benoit Delbosc
        date: '2013-12-03 15:54'
        message: ''
        version: '38'
    -
        author: Benoit Delbosc
        date: '2013-12-03 15:54'
        message: ''
        version: '37'
    -
        author: Solen Guitter
        date: '2013-10-10 16:52'
        message: Removed related topics from TOC
        version: '36'
    -
        author: Benoit Delbosc
        date: '2013-06-04 12:09'
        message: Migration of unmigrated content due to installation of a new plugin
        version: '35'
    -
        author: Benoit Delbosc
        date: '2013-06-04 12:09'
        message: ''
        version: '34'
    -
        author: Benoit Delbosc
        date: '2013-04-19 12:28'
        message: Migration of unmigrated content due to installation of a new plugin
        version: '33'
    -
        author: Benoit Delbosc
        date: '2013-04-19 12:28'
        message: ''
        version: '32'
    -
        author: Thierry Martins
        date: '2013-03-08 17:09'
        message: add hibernate sequence paragraph
        version: '31'
    -
        author: Benoit Delbosc
        date: '2013-01-23 11:41'
        message: ''
        version: '30'
    -
        author: Benoit Delbosc
        date: '2012-12-03 16:41'
        message: ''
        version: '29'
    -
        author: Florent Guillaume
        date: '2012-09-26 12:02'
        message: Migration of unmigrated content due to installation of a new plugin
        version: '28'
    -
        author: Florent Guillaume
        date: '2012-09-26 12:02'
        message: Migration of unmigrated content due to installation of a new plugin
        version: '27'
    -
        author: Florent Guillaume
        date: '2012-09-26 12:02'
        message: Migrated to Confluence 4.0
        version: '26'
    -
        author: Florent Guillaume
        date: '2012-09-26 12:02'
        message: no GRANT ALTER TABLE exists
        version: '25'
    -
        author: Benoit Delbosc
        date: '2012-09-24 16:24'
        message: ''
        version: '24'
    -
        author: Benoit Delbosc
        date: '2012-09-24 16:21'
        message: Adding a reporting problems section
        version: '23'
    -
        author: Solen Guitter
        date: '2012-05-10 12:13'
        message: ''
        version: '22'
    -
        author: Solen Guitter
        date: '2012-05-10 11:17'
        message: Added related pages
        version: '21'
    -
        author: Solen Guitter
        date: '2012-03-28 18:27'
        message: Added TOC
        version: '20'
    -
        author: Stéphane Lacoin
        date: '2012-03-28 17:53'
        message: ''
        version: '19'
    -
        author: Florent Guillaume
        date: '2012-02-17 14:28'
        message: Amazon RDS
        version: '18'
    -
        author: Florent Guillaume
        date: '2012-01-26 14:13'
        message: ''
        version: '17'
    -
        author: Florent Guillaume
        date: '2012-01-26 13:59'
        message: ''
        version: '16'
    -
        author: Antoine Taillefer
        date: '2011-12-23 19:02'
        message: ''
        version: '15'
    -
        author: Stéphane Lacoin
        date: '2011-11-23 14:08'
        message: ''
        version: '14'
    -
        author: Stéphane Lacoin
        date: '2011-11-23 14:05'
        message: ''
        version: '13'
    -
        author: Wojciech Sulejman
        date: '2011-03-08 20:42'
        message: ''
        version: '12'
    -
        author: Solen Guitter
        date: '2011-03-04 17:22'
        message: ''
        version: '11'
    -
        author: Florent Guillaume
        date: '2011-01-18 15:34'
        message: ''
        version: '10'
    -
        author: Florent Guillaume
        date: '2011-01-18 15:06'
        message: ''
        version: '9'
    -
        author: Florent Guillaume
        date: '2010-12-23 15:45'
        message: ''
        version: '8'
    -
        author: Florent Guillaume
        date: '2010-12-23 15:41'
        message: ''
        version: '7'
    -
        author: Florent Guillaume
        date: '2010-11-25 12:52'
        message: ''
        version: '6'
    -
        author: Julien Carsique
        date: '2010-10-29 18:16'
        message: 'moved driver information to [NXDOC:Configuring Nuxeo EP]'
        version: '5'
    -
        author: Julien Carsique
        date: '2010-10-29 12:22'
        message: Add jdbc driver information
        version: '4'
    -
        author: Florent Guillaume
        date: '2010-10-07 18:49'
        message: ''
        version: '3'
    -
        author: Florent Guillaume
        date: '2010-09-08 18:06'
        message: ''
        version: '2'
    -
        author: Florent Guillaume
        date: '2010-08-13 16:07'
        message: ''
        version: '1'

---
The Nuxeo Platform supports the following version of Oracle:

{{{multiexcerpt 'Oracle-supported' page='Compatibility Matrix'}}}

## Oracle Text (Full-Text)

If you've configured your Nuxeo Platform instance to index full-text using the SQL database (by disabling the default configuration which uses Elasticsearch),
Oracle Text needs to be enabled in your database, please consult your Oracle documentation.

If you fail to install Oracle Text, you will get on startup the following error:

```
java.sql.SQLException: ORA-29833: indextype does not exist

```

In addition, if you want to configure specific lexers or word lists then check [http://download.oracle.com/docs/cd/B19306_01/text.102/b14218/cdatadic.htm](http://download.oracle.com/docs/cd/B19306_01/text.102/b14218/cdatadic.htm) for configuration parameters and syntax. Lexers and word lists are used by the Nuxeo Platform when configured in its `default-repository-config.xml` file.

### Error DRG-50857
On Oracle 11.2.0.3 and 11.2.0.4, the installation of Oracle Text may fail because some information on the CTXSYS user is not correctly configured. This exception will be thrown in Nuxeo logs:
```
org.nuxeo.ecm.core.api.NuxeoException: java.sql.SQLException: Error executing: CREATE INDEX "FULLTEXT_FULLTEXT_IDX" ON "FULLTEXT"("FULLTEXT") INDEXTYPE IS CTXSYS.CONTEXT PARAMETERS(' SYNC (ON COMMIT) TRANSACTIONAL') : ORA-29855: error occurred in the execution of ODCIINDEXCREATE routine
ORA-20000: Oracle Text error:
DRG-50857: oracle error in drstldef
DRG-50858: OCI error: OCI_INVALID_HANDLE
DRG-50857: oracle error in get functional cache size
ORA-20000: Oracle Text error:
DRG-50857: oracle error in drixmd.GetSysParam
ORA-01403: no data found
ORA-06512: at "CTXSYS.DRUE", line 160
ORA-06512: at "CTXSYS.DRVXMD", line 639
ORA-06512: at line 1
```
The following command has to be run with the CTXSYS user to fix the problem:
```
INSERT INTO CTX_PARAMETERS (PAR_VALUE,PAR_NAME) VALUES ('20971520','FUNCTIONAL_CACHE_SIZE');
```

## DB_BLOCK_SIZE Configuration

The Nuxeo Platform requires the configuration of `DB_BLOCK_SIZE`, the size of Oracle database blocks. Whereas typical values are `4096` and `8192` bytes, you need to set it to **8192** to make the Nuxeo Platform properly work. Use this query to get the current value set in your Oracle database:

```sql
SELECT value FROM v$parameter WHERE name = 'db_block_size';
```

Possible error if the correct value is not used:

```
java.sql.SQLException: Error executing: CREATE INDEX DC_CONTRIBUTORS_ITEM_IDX ON DC_CONTRIBUTORS(ITEM) : ORA-01450: maximum key length (3118) exceeded
```

## Grant on DBMS_CRYPTO

In order for optimizations to be working in Nuxeo when using Oracle, hashing functions are needed and you need to grant `DBMS_CRYPTO` execution:

```
GRANT EXECUTE ON SYS.DBMS_CRYPTO TO nuxeo;

```

(Replace `nuxeo` with the database user.)

Note that for Oracle running on Amazon RDS, `DBMS_CRYPTO` is directly accessible and you may simply do:

```
GRANT EXECUTE ON DBMS_CRYPTO TO nuxeo;

```

Possible errors if you don't do this grant are:

```
java.sql.SQLException: ORA-06550: line 1, column 7: PLS-00905: object NUXEO.NX_REBUILD_READ_ACLS is invalid

```

## Create Hibernate Sequence

If the first startup fails with the following error in your logs,

<pre>ERROR [org.hibernate.util.JDBCExceptionReporter] ORA-02289: sequence does not exist
</pre>

you need to run this statement as your Oracle user

```
CREATE SEQUENCE HIBERNATE_SEQUENCE;
```

Grant for CREATE TABLE

As the Nuxeo Platform creates tables in the database at first startup, you need to grant `CREATE TABLE` to your database user.

```
GRANT CREATE TABLE TO nuxeo;

```

## Other Grants

The following more standard grants must also be executed :

```
GRANT CONNECT TO nuxeo;
GRANT RESOURCE TO nuxeo;

```

The following is sometimes needed, if you have several schemas:

```
GRANT SELECT ANY TABLE TO nuxeo;

```

## Restricted Environment with No GRANT

Some DBA will provide a restricted schema where there is no GRANT on your database.

In that case, you'll have to run this command, whereas usually DBMS_LOB is granted to public.

```
GRANT EXECUTE ON DBMS_LOB TO nuxeo;
```

To summarize, here are the list of all GRANTs needed:

```
- CONNECT
- RESOURCE
- SELECT ANY TABLE
- CREATE TABLE
- CREATE PROCEDURE
- CREATE SEQUENCE
- CREATE TRIGGER
- CREATE TYPE
- CREATE VIEW
- EXECUTE ON DBMS_LOB
- EXECUTE ON DBMS_CRYPTO
```

## Character Set

Your database must be configured with `NLS_CHARACTERSET` set to `AL32UTF8`. If your database character set is not `AL32UTF8`, you may observe incorrect behavior including:

*   Error while trying to insert null values into `acl_user` table ( `ORA-01400: cannot insert NULL into ("NUXEO"."ACLR_USER"."USER_ID")` ).
*   Incorrect storage of accented or special characters.
*   No tree structure visible on the left of the Nuxeo Platform.
*   Queries returning no document.

To check the character set on your server, execute:

```
SELECT value FROM NLS_DATABASE_PARAMETERS WHERE parameter = 'NLS_CHARACTERSET';

```

If you need to change the character set of you database, please check [https://docs.oracle.com/database/121/NLSPG/ch11charsetmig.htm](https://docs.oracle.com/database/121/NLSPG/ch11charsetmig.htm).

If for some reason you must use an unsupported character set that is not in the list: `AL32UTF8`, `UTF8`, `US7ASCII`, `WE8DEC`, `WE8ISO8859P1`, `WE8MSWIN1252`, then you will need an additional `orai18n.jar` JAR in your Java class path.

1.  Download `orai18n.jar` at [http://www.oracle.com/technetwork/database/features/jdbc/index-091264.html](http://www.oracle.com/technetwork/database/features/jdbc/index-091264.html).
2.  Add it in the class path for your Nuxeo server. For instance, in JBoss, you just put the jar in `$JBOSS/server/default/lib`. (The file `orai18n.jar` replaces the `nls_charset*.*` files in the Oracle 9i and older releases.) However this may or may not work depending on your Oracle version, installation specifics and other factors, and the only supported solution by the Nuxeo Platform is to use the  `AL32UTF8` charset.

{{#> callout type='info' heading='Technical explanation'}}

Internally, for security checks, the Nuxeo Platform executes SQL statements that need to be passed ARRAY objects (for the list of principals and permissions), but if the correct character set is not installed then the Oracle JDBC driver behaves incorrectly and Oracle actually receives empty strings. This in turn results in empty results for the queries as none of the documents will match due to incorrect security checks. The orai18n.jar fixes this.

{{/callout}}

## Import/Export

Starting with 11g R2, Oracle does not allocate space for a table until the first row gets inserted into the table. What happens is if you take an export of the schema/database, the dump would not include any of the tables that havn't got any space allocations yet. A configuration change needs to be done to allocate space even for tables with no records.

<pre>ALTER SYSTEM SET deferred_segment_creation=false;
</pre>

## JDBC Driver

The Nuxeo Platform needs the Oracle JDBC driver to establish a connection to the database.

The driver can be downloaded from the [Oracle JDBC driver downloads site](http://www.oracle.com/technetwork/database/features/jdbc/index-091264.html). We recommend the latest version for 12.1.0.2 : `ojdbc7.jar` for JDK 8.

The driver must be in the `$NUXEO_HOME/lib` directory. If you are using the `oracle` template (`nuxeo.templates=oracle` in `nuxeo.conf`), just put the driver in the `$NUXEO_HOME/templates/oracle/lib` directory.

## Limitations

Oracle is used by a lot of our customers. Nevertheless it's not perfect.

Oracle limitations:

*   The well-known Oracle-specific equivalence of `NULL` and an empty string causes headaches and performance degradations in a number of places.
*   Oracle has problems on some `LEFT OUTER JOINS` using the standard ANSI syntax when combined with full-text queries, and has to be reverted to its non-standard implicit join syntax using `(+)` which cannot be used in all cases ([NXP-5410](https://jira.nuxeo.com/browse/NXP-5410)).
*   PL/SQL pipelined functions or functions called from a `SELECT` cannot do DML (`INSERT`, `UPDATE`, `DELETE`) (ORA-14551) without starting an autonomous transaction. For consistency reasons starting an autonomous transaction is out of the question. This makes some code (used in clustering) inherently slower.
*   Table name limitation to 30 characters makes for very unreadable table names when using user-defined schemas.

## Reporting Problems

If you have a database configuration problem and you want to fill a JIRA ticket, there are some information to report:

*   The Oracle server state: is it dedicated or shared, which OS, how many CPU, RAM, is it a virtual machine...

*   How much memory is available on the database server (free -m output).

*   Amount of Nuxeo documents and Oracle configuration. Using the "sqlplus" command line tool connect to your Nuxeo database and execute the following commands:

<pre># Get the Nuxeo SQL script to dump your configuration
wget --no-check-certificate https://gist.github.com/bdelbosc/7766893/raw/dump-nuxeo-oracle-conf.sql
# Run the script against your database
sqlplus nuxeo/nuxeo@NUXEO @dump-nuxeo-oracle-conf.sql</pre>

and attach the output file located in `/tmp/oraconf.txt` into the JIRA ticket.

* * *

<div class="row" data-equalizer data-equalize-on="medium"><div class="column medium-6">{{#> panel heading='Related Documentation'}}

- [Connecting Nuxeo to the Database]({{page page='connecting-nuxeo-to-the-database'}})
- [HOWTO: Estimate Volume Usage]({{page page='how-to-estimate-volume-usage'}})
- [Ports Usage and Firewall Considerations]({{page page='ports-usage-and-firewall-considerations'}})

{{/panel}}</div><div class="column medium-6">

&nbsp;

</div></div>
