---
title: How to Query Workflow Objects
review:
    comment: ''
    date: '2017-12-15'
    status: ok
details:
    howto:
        excerpt: Learn how to query workflow objects using NXQL.
        level: Advanced
        tool: Studio
        topics: 'Workflow, NXQL, Query'
labels:
    - lts2016-ok
    - query-pageprovider-component
    - persistence
    - nxql
    - workflow
    - kleturc
    - link-update
    - howto
    - community-links
    - excerpt
    - lts2017-ok
toc: true
confluence:
    ajs-parent-page-id: '19235619'
    ajs-parent-page-title: Workflow How-To Index
    ajs-space-key: NXDOC
    ajs-space-name: Nuxeo Platform Developer Documentation
    canonical: How+to+Query+Workflow+Objects
    canonical_source: 'https://doc.nuxeo.com/display/NXDOC/How+to+Query+Workflow+Objects'
    page_id: '13664736'
    shortlink: 4IHQ
    shortlink_source: 'https://doc.nuxeo.com/x/4IHQ'
    source_link: /display/NXDOC/How+to+Query+Workflow+Objects
tree_item_index: 100
history:
    -
        author: Solen Guitter
        date: '2014-12-05 18:05'
        message: ix links to point to latest versio
        version: '51'
    -
        author: Manon Lumeau
        date: '2014-09-09 15:57'
        message: ''
        version: '50'
    -
        author: Manon Lumeau
        date: '2014-09-09 15:47'
        message: ''
        version: '49'
    -
        author: Manon Lumeau
        date: '2014-09-09 15:31'
        message: ''
        version: '48'
    -
        author: Manon Lumeau
        date: '2014-09-09 15:09'
        message: ''
        version: '47'
    -
        author: Manon Lumeau
        date: '2014-09-09 14:43'
        message: ''
        version: '46'
    -
        author: Solen Guitter
        date: '2013-11-13 13:29'
        message: ''
        version: '45'
    -
        author: Solen Guitter
        date: '2013-10-21 15:11'
        message: ''
        version: '44'
    -
        author: Solen Guitter
        date: '2013-10-21 15:10'
        message: ''
        version: '43'
    -
        author: Solen Guitter
        date: '2013-10-21 15:05'
        message: ''
        version: '42'
    -
        author: Alain Escaffre
        date: '2013-10-19 12:41'
        message: ''
        version: '41'
    -
        author: Mariana Cedica
        date: '2013-08-07 14:56'
        message: ''
        version: '40'
    -
        author: Mariana Cedica
        date: '2013-08-07 14:54'
        message: ''
        version: '39'
    -
        author: Solen Guitter
        date: '2013-07-18 14:53'
        message: Added excerpt
        version: '38'
    -
        author: Solen Guitter
        date: '2013-05-16 15:06'
        message: ''
        version: '37'
    -
        author: Solen Guitter
        date: '2013-05-16 14:57'
        message: ''
        version: '36'
    -
        author: Solen Guitter
        date: '2013-05-16 14:57'
        message: Added related pages  and format
        version: '35'
    -
        author: Mariana Cedica
        date: '2013-05-15 22:09'
        message: ''
        version: '34'
    -
        author: Mariana Cedica
        date: '2013-05-15 22:07'
        message: ''
        version: '33'
    -
        author: Mariana Cedica
        date: '2013-05-15 19:53'
        message: ''
        version: '32'
    -
        author: Mariana Cedica
        date: '2013-05-15 19:52'
        message: ''
        version: '31'
    -
        author: Mariana Cedica
        date: '2013-05-15 19:47'
        message: ''
        version: '30'
    -
        author: Mariana Cedica
        date: '2013-05-15 19:42'
        message: ''
        version: '29'
    -
        author: Mariana Cedica
        date: '2013-05-15 19:40'
        message: ''
        version: '28'
    -
        author: Mariana Cedica
        date: '2013-05-15 19:40'
        message: ''
        version: '27'
    -
        author: Mariana Cedica
        date: '2013-05-15 19:36'
        message: ''
        version: '26'
    -
        author: Mariana Cedica
        date: '2013-05-15 19:34'
        message: ''
        version: '25'
    -
        author: Mariana Cedica
        date: '2013-05-15 19:34'
        message: ''
        version: '24'
    -
        author: Mariana Cedica
        date: '2013-05-15 19:33'
        message: ''
        version: '23'
    -
        author: Mariana Cedica
        date: '2013-05-15 19:29'
        message: ''
        version: '22'
    -
        author: Mariana Cedica
        date: '2013-05-15 19:18'
        message: ''
        version: '21'
    -
        author: Mariana Cedica
        date: '2013-05-15 19:17'
        message: ''
        version: '20'
    -
        author: Mariana Cedica
        date: '2013-05-15 19:11'
        message: ''
        version: '19'
    -
        author: Mariana Cedica
        date: '2013-05-15 19:06'
        message: ''
        version: '18'
    -
        author: Mariana Cedica
        date: '2013-05-15 19:04'
        message: ''
        version: '17'
    -
        author: Mariana Cedica
        date: '2013-05-15 18:55'
        message: ''
        version: '16'
    -
        author: Mariana Cedica
        date: '2013-05-15 18:54'
        message: ''
        version: '15'
    -
        author: Mariana Cedica
        date: '2013-05-15 18:54'
        message: ''
        version: '14'
    -
        author: Mariana Cedica
        date: '2013-05-15 18:49'
        message: ''
        version: '13'
    -
        author: Mariana Cedica
        date: '2013-05-15 18:49'
        message: ''
        version: '12'
    -
        author: Mariana Cedica
        date: '2013-05-15 18:40'
        message: ''
        version: '11'
    -
        author: Mariana Cedica
        date: '2013-05-15 18:39'
        message: ''
        version: '10'
    -
        author: Mariana Cedica
        date: '2013-05-15 18:37'
        message: ''
        version: '9'
    -
        author: Mariana Cedica
        date: '2013-05-15 18:37'
        message: ''
        version: '8'
    -
        author: Mariana Cedica
        date: '2013-05-15 18:35'
        message: ''
        version: '7'
    -
        author: Mariana Cedica
        date: '2013-05-15 18:35'
        message: ''
        version: '6'
    -
        author: Mariana Cedica
        date: '2013-05-15 18:34'
        message: ''
        version: '5'
    -
        author: Mariana Cedica
        date: '2013-05-15 18:32'
        message: ''
        version: '4'
    -
        author: Mariana Cedica
        date: '2013-05-15 18:30'
        message: ''
        version: '3'
    -
        author: Mariana Cedica
        date: '2013-05-15 18:28'
        message: ''
        version: '2'
    -
        author: Mariana Cedica
        date: '2013-05-15 18:23'
        message: ''
        version: '1'

---
Workflows are stored in Nuxeo as documents of type "DocumentRoute". A workflow instance is created by copy from a workflow model. The lifecycle state for a workflow model is "validated", while the instances can be "running", "done" or "canceled".

A node in the workflow is stored as a document of type "RouteNode". A node has an unique id generated by Studio, set on the `rnode:nodeId` property. Nodes can be automatic steps or nodes of type task. If a node is of type task, that means a task (persisted by default as a document of type TaskDoc) is created when the workflow is executing that node. The workflow will be resumed only when this task is completed.

{{! excerpt}}

Since workflows, nodes and task are all documents, the [NXQL]({{page page='nxql'}}) query language can be used, like on any other document type.

{{! /excerpt}}

## Querying Workflows

### Using Lifecycle State

{{#> panel type='code' heading='Query all running workflows:'}}

```sql
SELECT * FROM DocumentRoute WHERE ecm:currentLifeCycleState = 'running'
```

{{/panel}}{{#> panel type='code' heading='Query all available workflow models:'}}

```sql
SELECT * FROM DocumentRoute WHERE ecm:currentLifeCycleState = 'validated'
```

{{/panel}}

### Using Workflow and Node Variables

Both workflow and node variables are persisted on the workflow and node documents. These are metadata stored on a dynamic [facet]({{page page='available-facets'}}), in a schema named as following:

*   for workflow variables, the name of the schema (and its prefix too) is `var_$WorkflowModelName`,
*   for node variables, is `var_$NodeId`.

The name of this facet is stored as the property:

*   `docri:variablesFacet` on the workflow documents
*   `rnode:variablesFacet` for nodes.

So both workflow and node variables can be queried as any other Nuxeo property.

{{#> panel type='code' heading='Query all running default serial workflows, having the global variable "initialComment" set to "test"'}}

```sql
SELECT * FROM DocumentRoute WHERE var_SerialDocumentReview:initiatorComment = 'test' Â 
```

{{/panel}}{{#> panel type='code' heading='Query all running workflows for a given document'}}

```sql
SELECT * FROM DocumentRoute WHERE docri:participatingDocuments IN ('$docId') AND ecm:currentLifeCycleState = 'running'
```

{{/panel}}

### Querying Workflows Suspended at a given Step

NXQL queries can reference any metadata. Using the [CoreSession#queryAndFetch](https://community.nuxeo.com/api/nuxeo/latest/javadoc/org/nuxeo/ecm/core/api/CoreSession.html#queryAndFetch-java.lang.String-java.lang.String-java.lang.Object...-) API we can look for workflows suspended on a given step. This will return in an [IterableQueryResult](http://community.nuxeo.com/api/nuxeo/latest/javadoc/org/nuxeo/ecm/core/api/IterableQueryResult.html) the id of the document representing the workflow document.

```sql
SELECT ecm:parentId FROM RouteNode WHERE rnode:nodeId = 'Task5237' AND ecm:currentLifeCycleState = 'suspended'
```

where 'Task5237' is the unique id of the node.

## Querying Workflow Tasks

{{#> panel type='code' heading='Query for all opened tasks'}}

```sql
SELECT * FROM TaskDoc WHERE ecm:currentLifeCycleState = 'opened'
```

{{/panel}}

* * *

<div class="row" data-equalizer data-equalize-on="medium">
<div class="column medium-6">
{{#> panel heading='Related How-Tos'}}

- [How to Modify a Workflow Variable outside of Workflow Context]({{page page='how-to-modify-a-workflow-variable-outside-of-workflow-context'}})
- [How to Set Up a Tasks Dashboard]({{page page='how-to-set-up-a-tasks-dashboard'}})
- [How to Make a Simple Task Assignment to One or Many Users]({{page page='how-to-make-a-simple-task-assignment-to-one-or-many-users'}})
- [How-To Index]({{page page='how-to-index'}})

{{/panel}}
</div>

<div class="column medium-6">
{{#> panel heading='Related Documentation'}}

- [Workflow in Nuxeo Studio]({{page space='studio' page='workflow'}})
- [Full-Text Queries]({{page page='full-text-queries'}})
- [NXQL]({{page page='nxql'}})
- [Variables Available in the Automation Context]({{page page='variables-available-in-the-automation-context'}})
- [Workflow]({{page page='workflow'}})

{{/panel}}
</div>
</div>
