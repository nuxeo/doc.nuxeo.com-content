---
title: Binary Metadata
description: The Nuxeo Platform enables to extract information from the uploaded files attached to a document and automatically fill in the document metadata at creation time.
review:
    comment: ''
    date: '2017-12-13'
    status: ok
labels:
    - lts2016-ok
    - link-update
    - binary-metadata
    - ajusto
    - binary-metadata-component
    - multiexcerpt-include
    - lts2017-ok
toc: true
confluence:
    ajs-parent-page-id: '16089319'
    ajs-parent-page-title: Additional Services
    ajs-space-key: NXDOC
    ajs-space-name: Nuxeo Platform Developer Documentation
    canonical: Binary+Metadata
    canonical_source: 'https://doc.nuxeo.com/display/NXDOC/Binary+Metadata'
    page_id: '23364291'
    shortlink: w4JkAQ
    shortlink_source: 'https://doc.nuxeo.com/x/w4JkAQ'
    source_link: /display/NXDOC/Binary+Metadata
tree_item_index: 900
history:
    -
        author: Manon Lumeau
        date: '2016-10-03 14:57'
        message: ''
        version: '55'
    -
        author: Manon Lumeau
        date: '2016-04-20 14:23'
        message: 'javadoc links updated '
        version: '54'
    -
        author: Solen Guitter
        date: '2016-02-09 15:38'
        message: ''
        version: '53'
    -
        author: Andre Justo
        date: '2015-10-13 10:01'
        message: updated BinaryMetadataProcessor method signatures
        version: '52'
    -
        author: Manon Lumeau
        date: '2015-08-25 13:07'
        message: ''
        version: '51'
    -
        author: Manon Lumeau
        date: '2015-08-10 15:43'
        message: ''
        version: '50'
    -
        author: Manon Lumeau
        date: '2015-08-10 15:43'
        message: ''
        version: '49'
    -
        author: Vladimir Pasquier
        date: '2015-05-26 12:41'
        message: ''
        version: '48'
    -
        author: Vladimir Pasquier
        date: '2015-05-26 12:40'
        message: ''
        version: '47'
    -
        author: Solen Guitter
        date: '2015-04-15 12:58'
        message: Add links to explorer and javadoc
        version: '46'
    -
        author: Vladimir Pasquier
        date: '2015-03-26 14:03'
        message: ''
        version: '45'
    -
        author: Vladimir Pasquier
        date: '2015-03-12 15:09'
        message: ''
        version: '44'
    -
        author: Solen Guitter
        date: '2015-02-18 09:25'
        message: format
        version: '43'
    -
        author: Vladimir Pasquier
        date: '2015-02-17 10:21'
        message: ''
        version: '42'
    -
        author: Vladimir Pasquier
        date: '2015-02-17 10:08'
        message: ''
        version: '41'
    -
        author: Vladimir Pasquier
        date: '2015-02-17 09:53'
        message: Add default metadata mapping contribution
        version: '40'
    -
        author: Vladimir Pasquier
        date: '2015-01-19 18:19'
        message: ''
        version: '39'
    -
        author: Vladimir Pasquier
        date: '2015-01-16 16:33'
        message: ''
        version: '38'
    -
        author: Bob Canaway
        date: '2015-01-15 15:09'
        message: ''
        version: '37'
    -
        author: Vladimir Pasquier
        date: '2015-01-13 13:14'
        message: ''
        version: '36'
    -
        author: Solen Guitter
        date: '2015-01-09 09:34'
        message: Title capitalization
        version: '35'
    -
        author: Vladimir Pasquier
        date: '2015-01-08 17:29'
        message: ''
        version: '34'
    -
        author: Vladimir Pasquier
        date: '2015-01-08 17:27'
        message: ''
        version: '33'
    -
        author: Bertrand Chauvin
        date: '2015-01-08 17:21'
        message: ''
        version: '32'
    -
        author: Vladimir Pasquier
        date: '2015-01-08 17:17'
        message: ''
        version: '31'
    -
        author: Vladimir Pasquier
        date: '2015-01-08 17:14'
        message: ''
        version: '30'
    -
        author: Vladimir Pasquier
        date: '2015-01-08 17:13'
        message: ''
        version: '29'
    -
        author: Vladimir Pasquier
        date: '2015-01-08 17:09'
        message: ''
        version: '28'
    -
        author: Vladimir Pasquier
        date: '2015-01-08 17:06'
        message: ''
        version: '27'
    -
        author: Vladimir Pasquier
        date: '2015-01-08 17:00'
        message: ''
        version: '26'
    -
        author: Vladimir Pasquier
        date: '2015-01-08 17:00'
        message: ''
        version: '25'
    -
        author: Bertrand Chauvin
        date: '2015-01-08 16:48'
        message: ''
        version: '24'
    -
        author: Vladimir Pasquier
        date: '2015-01-08 16:46'
        message: ''
        version: '23'
    -
        author: Vladimir Pasquier
        date: '2015-01-08 16:40'
        message: ''
        version: '22'
    -
        author: Bertrand Chauvin
        date: '2015-01-08 16:39'
        message: ''
        version: '21'
    -
        author: Vladimir Pasquier
        date: '2015-01-08 16:34'
        message: ''
        version: '20'
    -
        author: Vladimir Pasquier
        date: '2015-01-08 16:31'
        message: ''
        version: '19'
    -
        author: Vladimir Pasquier
        date: '2015-01-08 16:30'
        message: ''
        version: '18'
    -
        author: Vladimir Pasquier
        date: '2015-01-08 16:29'
        message: ''
        version: '17'
    -
        author: Vladimir Pasquier
        date: '2015-01-08 16:28'
        message: ''
        version: '16'
    -
        author: Vladimir Pasquier
        date: '2015-01-08 16:28'
        message: ''
        version: '15'
    -
        author: Solen Guitter
        date: '2015-01-07 08:54'
        message: format
        version: '14'
    -
        author: Vladimir Pasquier
        date: '2015-01-06 15:49'
        message: ''
        version: '13'
    -
        author: Vladimir Pasquier
        date: '2015-01-06 15:39'
        message: ''
        version: '12'
    -
        author: Vladimir Pasquier
        date: '2015-01-05 19:15'
        message: ''
        version: '11'
    -
        author: Vladimir Pasquier
        date: '2015-01-05 19:06'
        message: ''
        version: '10'
    -
        author: Vladimir Pasquier
        date: '2015-01-05 16:28'
        message: ''
        version: '9'
    -
        author: Vladimir Pasquier
        date: '2015-01-05 16:26'
        message: ''
        version: '8'
    -
        author: Vladimir Pasquier
        date: '2015-01-05 16:21'
        message: ''
        version: '7'
    -
        author: Vladimir Pasquier
        date: '2015-01-05 16:17'
        message: ''
        version: '6'
    -
        author: Vladimir Pasquier
        date: '2015-01-05 16:16'
        message: ''
        version: '5'
    -
        author: Vladimir Pasquier
        date: '2015-01-05 16:15'
        message: ''
        version: '4'
    -
        author: Vladimir Pasquier
        date: '2015-01-05 16:04'
        message: ''
        version: '3'
    -
        author: Vladimir Pasquier
        date: '2015-01-05 16:03'
        message: ''
        version: '2'
    -
        author: Vladimir Pasquier
        date: '2015-01-05 16:01'
        message: ''
        version: '1'

---
{{{multiexcerpt 'automated-metadata-extraction-excerpt' page='USERDOC:Creating Content'}}}

## How It Works

A Nuxeo listener watches for document creation/modification and triggers metadata mapping in the following conditions:

*   On document creation, if the attached binary is not empty, the listener reads the metadata and updates the document.
*   On document modification:
    *   If the attached binary has changed and the document metadata has not, the listener reads the metadata from attached binary and stores it into the document.
    *   If the attached binary has changed and the document metadata also has changed, the listener writes the metadata from the document to the attached binary.
    *   If the attached binary hasn't changed and the document metadata has changed, the listener writes the metadata from the document to the attached binary.

You can contribute your own metadata mapping and choose to have it applied with the same rules and / or through Nuxeo Automation operations.

By default the Nuxeo Platform uses [ExifTool](http://www.sno.phy.queensu.ca/%7Ephil/exiftool/)&nbsp;which supports many different data formats including [EXIF](http://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/EXIF.html)<span style="color: rgb(0,0,0);">,&nbsp;</span>[GPS](http://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/GPS.html)<span style="color: rgb(0,0,0);">,&nbsp;</span>[IPTC](http://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/IPTC.html)<span style="color: rgb(0,0,0);">,&nbsp;</span>[XMP](http://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/XMP.html). You can refer to its documentation for further details and a complete list of formats. Other processors can be added if needed.

## Contributing Metadata Mappings

Metadata mapping is made through an XML contribution on the [`metadataMappings`](http://explorer.nuxeo.com/nuxeo/site/distribution/latest/viewExtensionPoint/org.nuxeo.binary.metadata--metadataMappings) extension point:

```xml
   <!-- Map binary metadata to Nuxeo document metadata -->

  <extension target="org.nuxeo.binary.metadata"
             point="metadataMappings">
    <!-- Define "processor" to use and specify the attached binary's xpath ("blobXPath") -->
    <!-- Technical "id" should be unique  -->
    <!-- "ignorePrefix" is by default set to true. Here metadata have prefixes, so set it to false. -->
    <metadataMapping id="Example" processor="exifTool" blobXPath="file:content" ignorePrefix="false">
      <!-- "name" = binary metadata  , "xpath" = document metadata -->
      <!-- See PDF metadata extraction example in this page -->
      <metadata name="PDF:Producer" xpath="dc:title"/>
      <metadata name="PDF:Author" xpath="dc:description"/>
    </metadataMapping>
 </extension>

```

## Contributing Metadata Rules

{{#> callout type='info' }}

This part is only needed if you plan to use your metadata mapping with the standard listener.

{{/callout}}

Metadata rules are defined through an XML contribution on the&nbsp;[`metadataRules`](http://explorer.nuxeo.com/nuxeo/site/distribution/latest/viewExtensionPoint/org.nuxeo.binary.metadata--metadataRules) extension point:

```xml
 <!-- Define which mappings will be called by the listener, and under which conditions -->
 <extension target="org.nuxeo.binary.metadata"
             point="metadataRules">
   <!-- "order" = priority , "async" = listener mode (set "true" to apply mapping as background work) -->
   <!-- Technical "id" should be unique  -->
   <rule id="default" order="0" enabled="true" async="false">
      <metadataMappings>
        <metadataMapping-id>Example</metadataMapping-id>
        <metadataMapping-id>...</metadataMapping-id>
      </metadataMappings>
      <!-- see the link below for filter contributions -->
      <filters>
        <filter-id>hasFileType</filter-id>
        <filter-id>...</filter-id>
      </filters>
    </rule>
  </extension>

  <extension target="org.nuxeo.ecm.platform.actions.ActionService"
             point="filters">
    <filter id="hasFileType">
      <rule grant="true">
        <type>File</type>
      </rule>
    </filter>
  </extension>
```

[Filters contribution]({{page page='filters-and-access-controls'}}) documentation.

## Default Operations

*   **Document.SetMetadataFromBlob**: To write metadata to a Document from a binary according to a contributed metadata mapping.
*   **Blob.SetMetadataFromDocument**: To write metadata to a Blob (xpath parameter, or BlobHolder if empty) from a document (input) given a custom metadata mapping defined in a Properties parameter (xpath=metadataName), using a named processor (exifTool for instance).
*   **Blob.SetMetadataFromContext**: To write metadata to a Blob from Context using a named processor (exifTool for instance) and given metadata, and return the updated Blob.
*   **Context.SetMetadataFromBlob**: To read metadata from a Blob (input) given a custom list of metadata defined (or optional, to get all metadata in result of ExifTool) in a StringList parameter (metadataName1, metadataName2, ...), using a named processor (exifTool for instance), and put the result (a Map) in the Context.
*   **Blob.ReadMetadata**: To return Map of all binary properties in input.

## Contributing a New Processor

The Nuxeo default contribution for binary metadata processor is ExifTool:

```xml
<extension target="org.nuxeo.binary.metadata"
             point="metadataProcessors">
    <processor id="exifTool"
               class="org.nuxeo.binary.metadata.internals.ExifToolProcessor"
               prefix="true"/>
  </extension>
```

If you need to add a new processor:

1.  Declare a new contribution with specific id and class.

    ```xml
    <extension target="org.nuxeo.binary.metadata"
                 point="metadataProcessors">
        <processor id="myProcessor"
                   class="org.mycompany.my.MyProcessorClazz"/>
      </extension>
    ```

2.  Extend [`org.nuxeo.binary.metadata.api.BinaryMetadataProcessor`](http://community.nuxeo.com/api/nuxeo/latest/javadoc/org/nuxeo/binary/metadata/api/BinaryMetadataProcessor.html) and implement the following methods:

    ```java
    /**
         * Write given metadata into given blob. Since Nuxeo 7.3 ignorePrefix is added.
         *
         * @param blob Blob to write.
         * @param metadata Metadata to inject.
    	 * @param ignorePrefix
         * @return the updated blob, or {@code null} if there was an error
         */
        public Blob writeMetadata(Blob blob, Map<String, Object> metadata, boolean ignorePrefix);
        /**
         * Read from a given blob given metadata map. Since Nuxeo 7.3 ignorePrefix is added.
         *
         * @param blob Blob to read.
         * @param metadata Metadata to extract.
    	 * @param ignorePrefix
         * @return Metadata map.
         */
        public Map<String, Object> readMetadata(Blob blob, List<String> metadata, boolean ignorePrefix);
        /**
         * Read all metadata from a given blob. Since Nuxeo 7.3 ignorePrefix is added.
         *
         * @param blob Blob to read.
    	 * @param ignorePrefix
         * @return Metadata map.
         */
        public Map<String, Object> readMetadata(Blob blob, boolean ignorePrefix);
    ```

    Here is the [ExifTool example](https://raw.githubusercontent.com/nuxeo/nuxeo-binary-metadata/master/src/main/java/org/nuxeo/binary/metadata/internals/ExifToolProcessor.java) `org.nuxeo.binary.metadata.internals.ExifToolProcessor` and the [command line documentation]({{page page='how-to-contribute-a-command-line-converter'}}) to execute the command lines from the Nuxeo Platform.

## ExifTool Extraction Example

Metadata extraction example from a PDF file using ExifTool:

```
> exiftool -G -json hello.pdf
[{
  "SourceFile": "hello.pdf",
  "ExifTool:ExifToolVersion": 9.76,
  "File:FileName": "hello.pdf",
  "File:Directory": ".",
  "File:FileSize": "30 kB",
  "File:FileModifyDate": "2015:01:05 14:57:19+01:00",
  "File:FileAccessDate": "2015:01:05 17:02:43+01:00",
  "File:FileInodeChangeDate": "2015:01:05 14:57:19+01:00",
  "File:FilePermissions": "rwxr-xr-x",
  "File:FileType": "PDF",
  "File:MIMEType": "application/pdf",
  "PDF:PDFVersion": 1.4,
  "PDF:Linearized": "No",
  "PDF:PageCount": 1,
  "PDF:Language": "en-US",
  "PDF:Author": "John Doe",
  "PDF:Creator": "Writer",
  "PDF:Producer": "OpenOffice.org 3.2",
  "PDF:CreateDate": "2010:10:26 15:48:33+02:00"
}]
```

## Metrics

Metrics have been added to Binary Metadata services to monitor default/custom processor performances with Nuxeo.

To activate it, the following variable in nuxeo.conf must be set:

```
binary.metadata.monitor.enable=true
```

Or log4j level to TRACE for [`org.nuxeo.binary.metadata.internals.BinaryMetadataComponent`](http://community.nuxeo.com/api/nuxeo/latest/javadoc/org/nuxeo/binary/metadata/internals/BinaryMetadataComponent.html) must be set.

This feature gives the ability to get time execution informations through JMX: `org.nuxeo.StopWatch`.

## Default Contribution

*   IPTC schema has been removed from document type Picture
*   Only `IPTC:Source`, `IPTC:CopyrightNotice`,&nbsp;`IPTC:Caption-Abstract` are stored respectively into `dc:source`,&nbsp;`dc:rights` and `dc:description`.
*   Widget&nbsp;`summary_picture_iptc` has been removed from document summary
*   Mistral engine is removed from metadata extraction of the Nuxeo Platform
*   EXIF mapping remains identical

Here is the default metadata mapping contribution in the Nuxeo Platform:

{{#> panel type='code' heading='Default Contribution'}}
```xml
<extension target="org.nuxeo.binary.metadata"
 point="metadataMappings">
  <metadataMapping id="EXIF" processor="exifTool" blobXPath="file:content" ignorePrefix="false">
    <metadata name="EXIF:ImageDescription" xpath="imd:image_description"/>
    <metadata name="EXIF:UserComment" xpath="imd:user_comment"/>
    <metadata name="EXIF:Equipment" xpath="imd:equipment"/>
    <metadata name="EXIF:DateTimeOriginal" xpath="imd:date_time_original"/>
    <metadata name="EXIF:XResolution" xpath="imd:xresolution"/>
    <metadata name="EXIF:YResolution" xpath="imd:yresolution"/>
    <metadata name="EXIF:PixelXDimension" xpath="imd:pixel_xdimension"/>
    <metadata name="EXIF:PixelYDimension" xpath="imd:pixel_ydimension"/>
    <metadata name="EXIF:Copyright" xpath="imd:copyright"/>
    <metadata name="EXIF:ExposureTime" xpath="imd:exposure_time"/>
    <metadata name="EXIF:ISO" xpath="imd:iso_speed_ratings"/>
    <metadata name="EXIF:FocalLength" xpath="imd:focalLength"/>
    <metadata name="EXIF:ColorSpace" xpath="imd:color_space"/>
    <metadata name="EXIF:WhiteBalance" xpath="imd:white_balance"/>
    <metadata name="EXIF:IccProfile" xpath="imd:icc_profile"/>
    <metadata name="EXIF:Orientation" xpath="imd:orientation"/>
    <metadata name="EXIF:FNumber" xpath="imd:fnumber"/>
  </metadataMapping>
  <metadataMapping id="IPTC" processor="exifTool" blobXPath="file:content" ignorePrefix="false">
    <metadata name="IPTC:Source" xpath="dc:source"/>
    <metadata name="IPTC:CopyrightNotice" xpath="dc:rights"/>
    <metadata name="IPTC:Caption-Abstract" xpath="dc:description"/>
  </metadataMapping>
</extension>
<extension target="org.nuxeo.binary.metadata"
 point="metadataRules">
  <rule id="iptc" order="0" enabled="true" async="false">
    <metadataMappings>
      <metadataMapping-id>EXIF</metadataMapping-id>
      <metadataMapping-id>IPTC</metadataMapping-id>
    </metadataMappings>
    <filters>
      <filter-id>hasPictureType</filter-id>
    </filters>
  </rule>
</extension>
<extension target="org.nuxeo.ecm.platform.actions.ActionService"
 point="filters">
  <filter id="hasPictureType">
    <rule grant="true">
      <type>Picture</type>
    </rule>
  </filter>
</extension>
```
{{/panel}}

* * *

<div class="row" data-equalizer data-equalize-on="medium"><div class="column medium-6">

{{! Please update the label in the Content by Label macro below. }}

&nbsp;

</div><div class="column medium-6">

{{! Please update the label and target spaces in the Content by Label macro below. }}

&nbsp;

</div></div>
