---
title: Nuxeo Salesforce Connector
review:
    comment: ''
    date: '2021-01-14'
    status: ok
labels:
    - lts2016-ok
    - salesforce-component
    - vpasquier
    - link-update
    - excerpt
    - multiexcerpt-include
    - lts2017-ok
    - deprecated
toc: true
hidden: true
confluence:
    ajs-parent-page-id: '16089349'
    ajs-parent-page-title: Nuxeo Add-Ons
    ajs-space-key: NXDOC
    ajs-space-name: Nuxeo Platform Developer Documentation
    canonical: Nuxeo+for+Salesforce
    canonical_source: 'https://doc.nuxeo.com/display/NXDOC/Nuxeo+for+Salesforce'
    page_id: '26316748'
    shortlink: zI_RAQ
    shortlink_source: 'https://doc.nuxeo.com/x/zI_RAQ'
    source_link: /display/NXDOC/Nuxeo+for+Salesforce
tree_item_index: 1800
history:
    -
        author: Solen Guitter
        date: '2016-07-11 15:26'
        message: ix format and lin
        version: '40'
    -
        author: Anne Jubert
        date: '2016-07-11 15:21'
        message: ''
        version: '39'
    -
        author: Anne Jubert
        date: '2016-06-29 09:41'
        message: ''
        version: '38'
    -
        author: Anne Jubert
        date: '2016-06-29 08:03'
        message: ''
        version: '37'
    -
        author: Anne Jubert
        date: '2016-06-28 19:41'
        message: ''
        version: '36'
    -
        author: Anne Jubert
        date: '2016-06-28 19:39'
        message: ''
        version: '35'
    -
        author: Anne Jubert
        date: '2016-06-28 15:36'
        message: ''
        version: '34'
    -
        author: Anne Jubert
        date: '2016-06-28 15:34'
        message: ''
        version: '33'
    -
        author: Anne Jubert
        date: '2016-06-28 15:21'
        message: ''
        version: '32'
    -
        author: Vladimir Pasquier
        date: '2016-06-16 15:30'
        message: ''
        version: '31'
    -
        author: Joshua Fletcher
        date: '2016-02-05 00:35'
        message: ''
        version: '30'
    -
        author: Solen Guitter
        date: '2016-01-04 09:43'
        message: ''
        version: '29'
    -
        author: Joshua Fletcher
        date: '2015-12-30 22:48'
        message: Improve SFDC docs.
        version: '28'
    -
        author: Solen Guitter
        date: '2015-12-21 16:43'
        message: ''
        version: '27'
    -
        author: Solen Guitter
        date: '2015-12-16 14:54'
        message: ''
        version: '26'
    -
        author: Vladimir Pasquier
        date: '2015-12-15 21:17'
        message: ''
        version: '25'
    -
        author: Vladimir Pasquier
        date: '2015-12-15 21:13'
        message: ''
        version: '24'
    -
        author: Vladimir Pasquier
        date: '2015-12-15 21:11'
        message: ''
        version: '23'
    -
        author: Vladimir Pasquier
        date: '2015-12-15 21:06'
        message: ''
        version: '22'
    -
        author: Vladimir Pasquier
        date: '2015-12-15 21:05'
        message: ''
        version: '21'
    -
        author: Vladimir Pasquier
        date: '2015-12-15 20:55'
        message: ''
        version: '20'
    -
        author: Vladimir Pasquier
        date: '2015-12-15 20:52'
        message: ''
        version: '19'
    -
        author: Vladimir Pasquier
        date: '2015-12-15 20:50'
        message: ''
        version: '18'
    -
        author: Vladimir Pasquier
        date: '2015-12-15 20:50'
        message: ''
        version: '17'
    -
        author: Vladimir Pasquier
        date: '2015-12-15 20:49'
        message: ''
        version: '16'
    -
        author: Vladimir Pasquier
        date: '2015-12-15 20:48'
        message: ''
        version: '15'
    -
        author: Vladimir Pasquier
        date: '2015-12-15 20:48'
        message: ''
        version: '14'
    -
        author: Vladimir Pasquier
        date: '2015-12-15 20:47'
        message: ''
        version: '13'
    -
        author: Solen Guitter
        date: '2015-11-30 09:43'
        message: 'NXDOC-658: Marketplace packages are now called Nuxeo Packages, format'
        version: '12'
    -
        author: Vladimir Pasquier
        date: '2015-11-05 21:44'
        message: ''
        version: '11'
    -
        author: Vladimir Pasquier
        date: '2015-11-05 21:40'
        message: ''
        version: '10'
    -
        author: Vladimir Pasquier
        date: '2015-10-13 17:47'
        message: ''
        version: '9'
    -
        author: Vladimir Pasquier
        date: '2015-10-09 20:38'
        message: ''
        version: '8'
    -
        author: Vladimir Pasquier
        date: '2015-10-06 19:12'
        message: ''
        version: '7'
    -
        author: Vladimir Pasquier
        date: '2015-10-06 17:39'
        message: ''
        version: '6'
    -
        author: Vladimir Pasquier
        date: '2015-10-06 17:39'
        message: ''
        version: '5'
    -
        author: Vladimir Pasquier
        date: '2015-09-28 20:01'
        message: ''
        version: '4'
    -
        author: Vladimir Pasquier
        date: '2015-09-28 19:47'
        message: ''
        version: '3'
    -
        author: Vladimir Pasquier
        date: '2015-09-28 19:47'
        message: ''
        version: '2'
    -
        author: Vladimir Pasquier
        date: '2015-09-28 19:32'
        message: ''
        version: '1'

---


{{! excerpt}}
The [Nuxeo Salesforce connector](https://connect.nuxeo.com/nuxeo/site/marketplace/package/nuxeo-salesforce) covers several use cases of integration between the Nuxeo Repository and Salesforce: 
* binding a folder in Nuxeo and an object (opportunity, case, account, ...) in Salesforce, for object level document / media library
* presenting to salesforce usuers object-contextual lists of documents based on custom metadata queries
* general search across the Nuxeo repository
{{! /excerpt}}

See [GitHub Readme](https://github.com/nuxeo/nuxeo-salesforce) for the Dev project description.

## Overview
Watch [this Nuxeo University video](https://university.nuxeo.com/learn/course/external/view/elearning/221/salesforce-connector) for a functional overview.

## Installation

### Architecture

The Nuxeo Salesforce connector is made of:

- a servert part, made available as a [Nuxeo marketplace package](https://connect.nuxeo.com/nuxeo/site/marketplace/package/nuxeo-salesforce) "nuxeo-salesforce" that installs a Nuxeo Platform addon.

- a Salesforce unlocked package that installs some Salesforce lightening components and a few more Saleforce resources

### Nuxeo Marketplace package installation

The Nuxeo Marketplace Package can be found [Here](https://connect.nuxeo.com/nuxeo/site/marketplace/package/nuxeo-salesforce).
{{{multiexcerpt 'MP-installation-easy' page='Generic Multi-Excerpts'}}}

Server requirements:
- You must be on HF-34 at least to benefit from all required bugfixes for an optimal experience with the Salesforce connector. 
- You also must set sames-site cookie policy in `nuxeo.conf`:
`nuxeo.server.cookies.sameSite=none` 
- Server must always be accessed in https
- If you deploy with direct download enabled, you will have to deploy a cors configuration on the S3 bucket to allow downloads from  *force.com* type of URLs.

### Salesforce package installation.

Prerequesites:
- You must have installed the [Salesforce CLI](https://developer.salesforce.com/docs/component-library/documentation/en/lwc/lwc.get_started_cli) and have it authenticated against your Salesforce organization.
- Your Salesforce organization must be on Salesforce lightening. Salesforce Aurora is not supported.

The Nuxeo Salesforce package is currently made available as an [unlocked package](https://developer.salesforce.com/docs/atlas.en-us.sfdx_dev.meta/sfdx_dev/sfdx_dev_unlocked_pkg_intro.htm). Nuxeo will longer term publish it as a managed package on Salesforce marketplace. 

To install the version of the unlocked salesforce package that has been validated with the version of the Nuxeo marketplace pacakge installed on your preprod  Nuxeo server instance, using sfdx client :

`sfdx force:package:install -p 04t7R000001WYVjQAO -k nxapp@sfdc`

`04t7R000001WYVjQAO` is the version id of the salesforce package for 10.10.14 version of the Nuxeo Marketplace pacakge. We will let on the Nuxeo Pacakge description on the Nuxeo Marketplace the right Salesforce package version id to use for a given Nuxeo package version.  

### Post Installation Setup

After installing the package, you need to configure Salesforce to be able to use the Nuxeo application.

#### Define the Nuxeo Application administrators

Add the `Nuxeo_Admins` permission set to the Salesforce user(s) that are allowed to configure the Nuxeo application (user bound to sfdx authentication already has the permission set so this is an optional step):

Go to `Setup > Users`, click on the name of the target user, then go to the `Permission Sets` section to add the permission set, choose "Permission Set Assignments", then select `Nuxeo_Admins`.

This can also be done from commandline using the `sfdx force:user:permset:assign` command

#### Define the Nuxeo Application users

Add the `Nuxeo_Users` permission set to the Salesforce users allowed to use the Nuxeo application, as we expalained above. You can also use **Permission Set Groups** to easily assign permission groups to multiple users.  \
Currently, Salesforce doesn't support assigning permission sets to **Public Groups**.

#### Add the target Nuxeo domain URL to CSP Trusted Sites.

Go to `Setup > CSP Trusted Sites` and create a new **Trusted Site** using the base https URL of the target Nuxeo server - without the trailing `/nuxeo` path. Example: `https://your.nuxeo-instance.com`
Make sure to select all the sources.
Note: the CSP policy is not always taken into account immediately. To avoid some cache issues, we recommend that you log out and log in again.

#### Create a Nuxeo Connection.

As a `Nuxeo_admins` user open the **Nuxeo** tab (this tab is only visible for Nuxeo_Admins) and follow the connection setup wizard. Don't forget to set the right username / password for the cURL call.  
NB: you will need Nuxeo instance admin credentials.
You can detect a cache issue when validating your connection if you don't get the confirmation of the correct configuration. Opening the dev console you will see some errors related to content policy on CMIS endpoint

### Validate your set up

You can validate that your set up is correct by using the Nuxeo Salesforce Lightening component on a given SF object's page (ex: an Opportunity record).
- Browse an opportunity record (or create one if you have none).
- Click on "Edit page" with an admin user of the org
- On the Layout design page of the record view, drop the Nuxeo component somewhere inside the layout.
- Activate the configuration (select Desktop)
- Save
- Go back to the record screen. 

If all previous steps went ok, you should be able to click on a "Log in" button, that will open a pop up asking for authentication against the Nuxeo server if the user is not already authenticated in there. You can then drop a document in the library, it will be created in the Nuxeo repository: everything is working!

### Next steps
You will see below that there are three modes for the Nuxeo component. You can use all of the modes in various places of your salesforce application, as many time as you need. We advise you to get familiar functionnaly with the various modes and their goals reading the generic functionnal documentation,  and then to focus on configuring each components you need in regards to your business requirements, reading the configuration/ customization documentation.

## User documentation
The Nuxeo Salesforce lightening component can behave in three different ways depending on its configuration:

- **Library**: this mode exposes a content library browser with the ability for the user to drag'n drop documents and create folders.
- **Content list**: this mode exposes the result of a query in the Nuxeo repository matching the list of content required for a given business context, with an option for searching for additionnal documents to add to that list
- **Search**: this mode displays a simple search user interface to look for documents across all the Nuxeo repository, with respect to security. 

In all of those modes, user can open a given document and see many details on it. We will start by documented that "document view", and then review each of the modes to provide functionnal help on using them.

### Document panel
The Nuxeo connector for Salesforce provide a way to access lists of documents, related to a search or the content of a folder. When clicking on the document title in the result, it opens a document pannel organized by tabs and with some actions bars. User can find the following areas in the document pannel:
- **Document actions**, all grouped on the top right of the pannel. By order:
   - *Edit with Nuxeo Drive*: displayed when user has the permission Write on the document, it allows to open the document for editing it with its native editor, like MS Word, or MS Excel. 
   - *Open in Nuxeo*: open the document in the Web UI user interface.
   - *Download*: performs a download of the main file (stored under the document property "file:content")
   - *Upload file*: available when the user has the Write permission on the document, to replace the main file (stored under the document property "file:content")
   - *Lock*:  available when the user has the Write permission on the document, allows to lock the document. See [user documentation about locking](https://doc.nuxeo.com/userdoc/content-lock/).
   - *Maximise*: maximises the document pannel, usually for having more space to previw the open content.
   - *Close*: closes the document pannel
- **Preview tab**: opens a preview of the document. Office documents are rendered in PDF, images are displayed as they are and videos are displayed with a player, using a smaller rendition than the original file.
- **Data tab**: displays generic metadata of the document (version label, state, list of tags, date of creation and modification and creator), a list of renditions available on the doc (PDF, thumbnail, ...), additionnal attachments (as they can be attached from Web UI)
- **History**: displays the last five audit entries on the document. The audit tracks all events happening on a document (modifications, creation, move, copy, ...).

### Content Library
The Content library mode is ideal when you want to offer a minimalistic document managemnt system for each Salesforce objects. Typical use case can be when you want to manage the documents you exchange both ways with a prospect or a customer, on an opportunity or a case. When the Nuxeo component is configured on a record page for the content library use case, the first time a user drops content on a Salesforce record instance, the Nuxeo component will create a folder in the Nuxeo repository with the same name and title as the record title, and create the dropped file underneath. From there user can create a set of folders and sub folders and organize content the way he needs.
On the content library component, the user can:
- Create folders, clicking on "New Folder"
- Upload new files, either by drag'n drop (it supports multiple files at once) or using the "Upload files" action.
- Browse the hierachy using the breadcrumb
- Search within the folder. The executed search looks for content starting from the currently opened folder.
- On each listed documents, user has a set of actions: main file download, Open In Nuxeo, Edit with Nuxeo Drive, Delete
- Clicking on the document name opens the Document pannel described in the previous section.

The created folder in Web UI holds a `salesforce` facet and some metadata are set automatically on the associated salesforce schema. By default, "sf:objectId","sf:objectType", "sf:objectAmount". See the configuration section to change that behaviour.

### Content List
The Content list mode is ideal when you want to display to the user a specific list of content that comes from the Nuxeo repository. Typical use case is for instance to display a list of relevant knowledge articles based on the context defined by the metadata of your open case. The list of content is specified by configuration in Nuxeo Studio with a Page provider, the same  way all documents lists and searches are specified in your customized Nuxeo Web UI. In the default behaviour without customization, the query made lists all documents for which the *dc:source* metadata of the document contains the current Salesforce obeject record id.

"*Link content*" button on top of the documents list allows to search for some content within the whole Nuxeo repository, and then to "link" it. In the standard configuration, clicking on "Link" on a given document will set the dc:source value of the document equal to the current Salesforce record id. It is possible to adapt what it does by configuration in Nuxeo studio, see section after.

Without any configuration, you can use the Content list mode as a way for the user to search for a document in the repository and "bookmark" it on the object. Current implementation requires ot have the write permission on the document and is limited to attach a docuemnt to one record only, but both of those limitations will be removed in the next version. Also, note that it is not possible to bookmark a proxy (= a published document).

### Search
The Search mode provides a simple search interface with a search input field that performs a full text search across the whole repository and returns documents the user has the persmision to see. The search result is made of tiles that display:
- the title of the document
- modification date
- text extract of the match of the searc input, in the title, the description of the binary content, with highlight of the searched term. 

Note that the search mode can be added on a Salesforce object layout as well as a menu action on the general top bar. To do so, you can search for "Nuxeo" on the left launcher and select "Nuxeo Search" to add it for all users.

## Configuration / Customization

### Salesforce UI configuration

The Nuxeo Lightening Network component is available for being integrated in customized Salesforce UIs. You can drop it inside any Salesforce Lightening container component (tabs, sections, pannels, etc...). You can drop the Nuxeo component several times on the same page. You can entitle it to Saleseforce permission framework.
Once you dropped the component, you must choose the behaviour type among:

- Library: this will expose a library browser with ability to drag'n drop documents.
- Content list: this will expose the result of a query , with the ability to do a mapping between the salesfoce current record and the documents.
- Search: this will display a global search component.

You can also specify a custom configuration, see "Nuxeo Salesforce service extension point" in the section after.

Note that you can drop the Nuxeo component as many time as you need on a given page, and on as many different pages / Salesforce objects you need, there is no limitation.

Limitation: the component cannot be activated on the Salesforce mobile view.

### Nuxeo Salesforce service extension point

The Nuxeo Salesforce connector addon installled via the Nuxeo Salesforce connector marketplace package deploys a new "Salesforce configuration" service in the Nuxeo Platform with an extension point that allows to contribute various configurations. When dropping the Nuxeo component on the page layout in the Lightning app builder, a `configuration` attribute allows to specify a configuration id (as a string). The lightning component when being loaded queries the configured configuration to Nuxeo server via an automation operation, which then asks to the Salesforce configuration service for the specified configuration and returns it to the Salesforce ligthening component. 

This configuration object is used to configure several behaviours of the component: used pageproviders, custom salesforce properties / nuxeo properties mappings, enablement/disablement of some user actions, etc. We provide below an example of such a configuration. You can [contribute this extension from Nuxeo Studio](how-to-contribute-to-an-extension).

`
<extension target="org.nuxeo.salesforce.SalesforceComponent"
      point="config">
            
      <library name="my">
        <title>My Library</title>
      	<root>/default-domain/workspaces/salesforce</root>
      	<nuxeo-drive>false</nuxeo-drive>
      	<sobject type='Opportunity'>Name,Description,Amount</sobject>
      </library>
      <listing name="my">
      	<title>My Listing</title>
      	<upload>false</upload>
      	<link-operation>Salesforce.MyLink</link-operation>
      	<link-test>function(doc, recordId) { return doc.properties['dc:source'] === recordId }</link-test>
      	<nuxeo-drive>true</nuxeo-drive>
      	<sobject type='Opportunity'>Name,Description,Amount</sobject>
      	<query>
      	function(context, params) {
      		params.pageProvider = "my-second-page-provider";
      		params.customerName = context.record.Name;
      	}
      	</query>
      </listing>
      <search name="my">
      	<title>My Search</title>
        <nuxeo-drive>true</nuxeo-drive>
      	<page-provider>advanced_search</page-provider>
      </search>
      
  </extension>
`
Note that you can contribute as many configurations you need, there is no limitation.

### Configuration use cases

#### Disabling Nuxeo Drive Direct Edit action
You may want to disable the **Edit** user action if your users do not use Nuxeo Drive, to avoid confusing them. You can do so with the following element under the root configuration element:
`<nuxeo-drive>true</nuxeo-drive>
`

#### Changing the root path where the folders are created for the library behaviour
When using the Content library mode, a folder will be created for each Salesforce object. It is possible to configure the Nuxeo repository path under which the folders will be created with the element

`<root>/default-domain/workspaces/salesforce</root>`
under the `<library>` element.

### Changing the the document type of the folder created for the library behaviour or more
The folder is creating calling an automation script named `Salesforce.TouchSFLibrary`. It is possible to override this automation script. See [the source](https://github.com/nuxeo/nuxeo-salesforce/blob/lts-2021/nuxeo-salesforce-core/src/main/resources/OSGI-INF/automation-contrib.xml) of the script for a better udnerstanding of its behaviour.
  
#### Changing labels
The Nuxeo components is implemented using the internationalisation framework of Salesforce. As a consequence by enabling the translation workbench, it is possible to change the label of any of the displayed labels in the component and translate it for any language.
The only label that is not translated with the Salesforce framework is the title of the component, that displays "Content Library" and "Content list". You can contribute another label using the element 
`<title></title>` 
The string provided will also be looked up as a key in the translation workbench.

#### Updating the page provider and properties mapping for the content list behaviour
The content list is designed for being able to configure the query used to fetch the documents it displays and allows to do a mapping between some of the properties of the Salesforce record and the parameters expected by the Nuxeo query. The following part of the configuration under the <listing> element does exactly this:
  
`<query>
      	function(context, params) {
      		params.pageProvider = "list-of-procedures-provider";
      		params.customerName = context.record.Name;
      	}
  </query>
  `
In this example, the developer must have configured the **list-of-procedures-provider** page provider initially in Nuxeo Studio. Then the "record" object inside the "context" map is used to get access to the properties of the current salesforce object, while the page providers parameters are under the "params" map.

#### Defining a new link operation for the Content List behaviour 
The "Link Content" action  provides to the users the ability to click on a Link button on each document of the search result. The behaviour associated to the Link/Unlink buttons can be changed by configuring another operation to call. The default one is `Salesforce.LinkAsSource`. See [the source](https://github.com/nuxeo/nuxeo-salesforce/blob/lts-2021/nuxeo-salesforce-core/src/main/resources/OSGI-INF/automation-contrib.xml) of the operation.

There is also a configurable test made to know when to display the Link or the Unlink button, see the following contribution:
`<link-test>function(doc, recordId) { return doc.properties['dc:source'] === recordId }</link-test>`


# Upcoming evolutions in the next version:
Next version of the addon is targeted for end of february and will include:
- New JWT Exchange authentication scheme, with the removal of the need of the "Login" button.
- All actions and data sections displa is configurable (so as to be able to remove any unwanted section)
- Business metadata section for custom metadata in the data tab, with the use of freemarker template authored in Nuxeo Studio for rendering the section. 
- The rendition used for the preview tab is configurable via an automation script.
- Ability to attach the Nuxeo component into the utility bar and detach it into a seprate screen for co-displa of the Salesforce obejct and contextual documents thpe of use case
- Adding document actions on all document listings consistently (search, library and listing modes)
- A full text search input on top of the document list
- Two place holder actions are added for more custom actions, plugged to some automation scripts.
- Default behaviour of the liking script is improved to support multiple attachments to the same document and for being able to link even iwthout the Write permission on the document.





