---
title: Smart Search
review:
    comment: ''
    date: '2017-01-30'
    status: ok
labels:
    - content-review-lts2016
    - link-update
    - smart-search
    - atchertchian
    - smart-search-component
    - multiexcerpt
    - content-review-lts2017
toc: true
confluence:
    ajs-parent-page-id: '16089349'
    ajs-parent-page-title: Nuxeo Add-Ons
    ajs-space-key: NXDOC
    ajs-space-name: Nuxeo Platform Developer Documentation
    canonical: Smart+Search
    canonical_source: 'https://doc.nuxeo.com/display/NXDOC/Smart+Search'
    page_id: '3868365'
    shortlink: zQY7
    shortlink_source: 'https://doc.nuxeo.com/x/zQY7'
    source_link: /display/NXDOC/Smart+Search
tree_item_index: 3400
history:
    -
        author: Solen Guitter
        date: '2016-08-30 14:32'
        message: ''
        version: '42'
    -
        author: Manon Lumeau
        date: '2016-04-29 16:31'
        message: ''
        version: '41'
    -
        author: Manon Lumeau
        date: '2016-02-11 10:06'
        message: ''
        version: '40'
    -
        author: Anahide Tchertchian
        date: '2016-02-11 08:13'
        message: 'NXP-18626: adapt github links to modules merge'
        version: '39'
    -
        author: Anahide Tchertchian
        date: '2016-02-11 08:11'
        message: 'NXP-18626: adapt github links to modules merge'
        version: '38'
    -
        author: Manon Lumeau
        date: '2016-02-10 13:53'
        message: 'Formatting '
        version: '37'
    -
        author: Manon Lumeau
        date: '2016-02-10 13:45'
        message: Merging Admin and User part on NXDOC
        version: '36'
    -
        author: Solen Guitter
        date: '2016-01-25 16:53'
        message: Fix related pages
        version: '35'
    -
        author: Anahide Tchertchian
        date: '2016-01-18 10:13'
        message: 'NXDOC-666: update doc to fit latest changes'
        version: '34'
    -
        author: Manon Lumeau
        date: '2015-12-24 10:44'
        message: Formatting
        version: '33'
    -
        author: Manon Lumeau
        date: '2015-12-24 10:43'
        message: ''
        version: '32'
    -
        author: Manon Lumeau
        date: '2015-12-24 10:41'
        message: Formatting
        version: '31'
    -
        author: Manon Lumeau
        date: '2015-12-24 10:32'
        message: 'Formatting '
        version: '30'
    -
        author: Solen Guitter
        date: '2015-08-31 14:31'
        message: Update table of contents look
        version: '29'
    -
        author: Solen Guitter
        date: '2014-12-05 18:56'
        message: Remove link to advanced search page (obsolete)
        version: '28'
    -
        author: Solen Guitter
        date: '2013-12-12 15:33'
        message: Updated excerpt
        version: '27'
    -
        author: Solen Guitter
        date: '2013-11-13 16:52'
        message: Updated links
        version: '26'
    -
        author: Solen Guitter
        date: '2013-09-04 18:22'
        message: ''
        version: '25'
    -
        author: Solen Guitter
        date: '2013-09-04 18:19'
        message: ''
        version: '24'
    -
        author: Solen Guitter
        date: '2013-02-18 19:04'
        message: ''
        version: '23'
    -
        author: Solen Guitter
        date: '2013-02-18 18:54'
        message: ''
        version: '22'
    -
        author: Solen Guitter
        date: '2012-09-11 22:23'
        message: Migrated to Confluence 4.0
        version: '21'
    -
        author: Solen Guitter
        date: '2012-09-11 22:23'
        message: Updated links to current snapshot
        version: '20'
    -
        author: Solen Guitter
        date: '2012-05-21 11:40'
        message: Updated 5.4 mercurial link to 5.6 snapshot github URL
        version: '19'
    -
        author: Anahide Tchertchian
        date: '2010-10-14 17:14'
        message: ''
        version: '18'
    -
        author: Anahide Tchertchian
        date: '2010-10-14 12:22'
        message: ''
        version: '17'
    -
        author: Anahide Tchertchian
        date: '2010-10-13 19:28'
        message: ''
        version: '16'
    -
        author: Anahide Tchertchian
        date: '2010-10-13 19:15'
        message: ''
        version: '15'
    -
        author: Anahide Tchertchian
        date: '2010-10-13 19:14'
        message: ''
        version: '14'
    -
        author: Anahide Tchertchian
        date: '2010-10-13 19:06'
        message: ''
        version: '13'
    -
        author: Anahide Tchertchian
        date: '2010-10-13 19:00'
        message: ''
        version: '12'
    -
        author: Anahide Tchertchian
        date: '2010-10-13 18:59'
        message: ''
        version: '11'
    -
        author: Anahide Tchertchian
        date: '2010-10-13 18:58'
        message: ''
        version: '10'
    -
        author: Anahide Tchertchian
        date: '2010-10-13 18:57'
        message: ''
        version: '9'
    -
        author: Anahide Tchertchian
        date: '2010-10-13 18:34'
        message: ''
        version: '8'
    -
        author: Anahide Tchertchian
        date: '2010-10-13 18:29'
        message: ''
        version: '7'
    -
        author: Anahide Tchertchian
        date: '2010-10-13 16:58'
        message: ''
        version: '6'
    -
        author: Anahide Tchertchian
        date: '2010-10-13 16:58'
        message: ''
        version: '5'
    -
        author: Anahide Tchertchian
        date: '2010-10-13 16:57'
        message: ''
        version: '4'
    -
        author: Anahide Tchertchian
        date: '2010-10-13 15:26'
        message: ''
        version: '3'
    -
        author: Anahide Tchertchian
        date: '2010-10-13 15:25'
        message: ''
        version: '2'
    -
        author: Anahide Tchertchian
        date: '2010-10-12 15:36'
        message: ''
        version: '1'

---
{{multiexcerpt 'DeprecatedAddon' space='nxdoc' page='generic-multi-excerpts'}}

## Installation

The [Smart search package](https://connect.nuxeo.com/nuxeo/site/marketplace/package/nuxeo-platform-smart-search) requires no specific installation steps. It can be installed like any other package [from the Marketplace or from the Admin Center]({{page page='installing-a-new-package-on-your-instance'}}).

After the package is installed, the Smart Search form is available from the **Search** tab.

![]({{file name='smart-search-link.png'}} ?w=310,border=true)

## Functional Overview

### Building a Smart Search{{> anchor 'build-query'}}

{{! multiexcerpt name='building-smart-search'}}

To build a query using Smart Search:

1.  Go to the **Search** tab and select **Smart Search** in the drop down menu of the search filters.

    The Smart Search form is displayed.
    ![]({{file name='Smart-Search-form.png' space='userdoc' page='smart-search'}} ?w=310,border=true)
2.  Select a first search criterion in the drop down list and fill in the corresponding field.
3.  Click on the **Add** button.
    The criterion is displayed in the text area below.
    ![]({{file name='Smart-Search-query.png' space='userdoc' page='smart-search'}} ?w=310,border=true)
4.  Possibly, add other criteria.

    {{#> callout type='tip' }}

    You can organize your search criteria in parenthesis.
    You can also use the **Undo** and **Clear** buttons to cancel actions when you build your query.

    {{/callout}}
5.  When your query is ready, click on **Add** and then on **Search**.
    The search results are displayed. You can click on the documents to consult them. You can also edit your search to refine the query or save your search.
    ![]({{file name='Smart-Search-results.png' space='userdoc' page='smart-search'}} ?w=650,border=true)

{{! /multiexcerpt}}

### Saving a Smart Search

{{! multiexcerpt name='saving-smart-search'}}

Smart Search enables users to save their search in smart folders. A smart folder is a folder that displays the result of the associated query. Every time a user click on the folder, the query is executed and the content displayed is updated.
Smart folders can be created in workspaces and folders.
There are two ways to create a smart folder:

*   you can first create your query and [save it](#save-search) in your personal workspace,
*   or you can [create a smart folder](#smart-folder) directly from a workspace.

{{#> callout type='tip' }}

Permissions cannot be managed on smart folders. If you want to share a smart search, you need to save it in a workspace or a folder that is shared with other users.

{{/callout}}

#### Saving a Smart Search

You can save a smart search from the search form directly or from the search results. When you save a smart search, it is automatically saved in your personal workspace.

{{> anchor 'save-search'}}To save a search in a smart folder:

1.  [Build your query](#build-query).
2.  From the search result page or from the search form, click on the **Save As** button.
3.  Give the smart search a title and click on **Save**.

    Once your smart search is saved, the smart folder is available:

    1.  in your personal workspace
        ![]({{file name='smart-folder-personal-workspace.png' space='userdoc' page='smart-search'}} ?w=600,border=true)

    2.  in the drop down list in the **Search tab**:
        ![]({{file name='saved-search.png' space='userdoc' page='smart-search'}} ?w=250,border=true)
    3.  in **Home**&nbsp;> **Searches**:
        ![]({{file name='hometab-searches.png' space='userdoc' page='smart-search'}} ?w=600,border=true)

#### Creating a Smart Folder

You can create a smart search in a workspace or in a folder.

{{> anchor 'smart-folder'}}To create a smart folder:
You can create a smart folder and then build the query that will be associated to it:

1.  In a workspace, click on **New**.
2.  In the modal window, click on **Smart folder**.
3.  On the creation form, type a title, a description (optional) and [build your query](#build-query).
4.  Click on the **Create** button to save the smart folder and display its content.
    The smart folder is saved.

{{! /multiexcerpt}}

## Technical Overview

### Smart Query Configuration

The smart query is designed to work in conjunction with a [content view]({{page space='NXDOC' page='Content Views'}}).
This content view search layout displays a selector to help building a query part, and a text area with the existing query parts already aggregated:

The [SmartQuery](https://github.com/nuxeo/nuxeo-platform-smart-search/blob/master/src/main/java/org/nuxeo/ecm/platform/smart/query/SmartQuery.java) interface is very simple: it can build a query (or query part) and can check if it is in a valid state.

The [IncrementalSmartQuery](https://github.com/nuxeo/nuxeo-platform-smart-search/blob/master/src/main/java/org/nuxeo/ecm/platform/smart/query/IncrementalSmartQuery.java) abstract class holds additional methods for a good interaction with UI JSF components. It is able to store an existing query part, and has getters and setters for the description of a new element to add to the query.

The [IncrementalSmartNXQLQuery](https://github.com/nuxeo/nuxeo-platform-smart-search/blob/master/src/main/java/org/nuxeo/ecm/platform/smart/query/jsf/IncrementalSmartNXQLQuery.java) class implements the `org.nuxeo.ecm.platform.smart.query.SmartQuery` interface and generates a query using the NXQL syntax.

The seam component named [smartNXQLQueryActions](https://github.com/nuxeo/nuxeo-platform-smart-search/blob/master/src/main/java/org/nuxeo/ecm/platform/smart/query/jsf/SmartNXQLQueryActions.java) exposes an instance of it, given an existing query part, and is used to update it on Ajax calls.

The complete list of layouts used to generate this screen is available here: [smart-query-layouts-contrib.xml](https://github.com/nuxeo/nuxeo-platform-smart-search/blob/master/src/main/resources/OSGI-INF/smart-query-layouts-contrib.xml).

The content view is configured to use the layout named `nxql_incremental_smart_query` as a search layout, and this content view is referenced both in the search form and search results templates: [smart-query-contentviews-contrib.xml](https://github.com/nuxeo/nuxeo-platform-smart-search/blob/master/src/main/resources/OSGI-INF/smart-query-contentviews-contrib.xml).

The easiest way to customize available query conditions is to override the definition of the layout named `incremental_smart_query_selection`. This layout uses the template [incremental_smart_query_selection_layout_template.xhtml](https://github.com/nuxeo/nuxeo-platform-smart-search/blob/master/src/main/resources/web/nuxeo.war/layouts/incremental_smart_query_selection_layout_template.xhtml) that accepts one property named "hideNotOperator". This property, if set to true, will hide the selection of the 'NOT' word that can be added in front of each criterion. If you do so, operators should include negative operators.

Here is an explanation on how to define this layout widgets, that need to be of type "incremental_smart_query_condition" to ensure a good behaviour with other layouts.

As a simple example, let's have a look at the widget to add a condition on the title:


```xml
<widget name="nxql_smart_query_condition_title"
  type="incremental_smart_query_condition">
  <labels>
    <label mode="any">title</label>
  </labels>
  <translated>true</translated>
  <properties widgetMode="edit">
    <property name="searchField">dc:title</property>
    <propertyList name="availableOperators">
      <value>CONTAINS</value>
      <value>LIKE</value>
      <value>=</value>
    </propertyList>
  </properties>
  <subWidgets>
    <widget name="title" type="text">
      <fields>
        <field>stringValue</field>
      </fields>
    </widget>
  </subWidgets>
</widget>

```

The properties `searchField` and `availableOperators` are used to set the left expression of the condition and the operator. The subwidget is a standard widget of type "text". It is bound to the "stringValue" field so it will be stored in the smart query instance field with the same name. Other additional properties supported by the "text" widget type can be added here (for instance, the `required` or `styleClass` properties).

Here is the complete list of available field bindings:

*   booleanValue
*   stringValue
*   stringListValue
*   stringArrayValue
*   datetimeValue
*   otherDatetimeValue (to be used in conjunction with datetimeValue)
*   dateValue
*   otherDateValue (to be used in conjunction with dateValue)
*   integerValue
*   floatValue (to bind a Double instance)

As a more complex example, let's have a look at the widget used to add a condition on the modification date:

```html/xml
<widget name="nxql_smart_query_condition_modified" type="incremental_smart_query_condition">
  <labels>
    <label mode="any">label.dublincore.modified</label>
  </labels>
  <translated>true</translated>
  <properties widgetMode="edit">
    <property name="searchField">dc:modified</property>
    <propertyList name="availableOperators">
      <value>BETWEEN</value>
      <value>NOT BETWEEN</value>
      <value>&lt;</value>
      <value>&gt;</value>
    </propertyList>
  </properties>
  <subWidgets>
    <widget name="modified" type="datetimeRange">
      <fields>
        <field>dateValue</field>
        <field>otherDateValue</field>
      </fields>
      <properties widgetMode="edit">
        <property name="required">true</property>
        <property name="format">#{nxu:basicDateFormatter()}</property>
      </properties>
      <widgetModes>
        <mode value="any">

          #{(empty value.conditionalOperator or value.conditionalOperator=='BETWEEN' or value.conditionalOperator=='NOT BETWEEN')?'edit':'hidden'}
          ]]>
        </mode>
      </widgetModes>
    </widget>
    <widget name="modified_before" type="datetime">
      <fields>
        <field>dateValue</field>
      </fields>
      <properties widgetMode="edit">
        <property name="required">true</property>
        <property name="format">#{nxu:basicDateFormatter()}</property>
      </properties>
      <widgetModes>
        <mode value="any">

          #{(empty value.conditionalOperator or value.conditionalOperator=='BETWEEN' or value.conditionalOperator=='NOT BETWEEN')?'hidden':'edit'}
          ]]>
        </mode>
      </widgetModes>
    </widget>
  </subWidgets>
</widget>

```

It is more complex as some subwidgets should not be shown depending on the chosen operator: when operator "BETWEEN" is selected, all of the three subwidgets should be displayed, whereas when other operators are selected, only the first subwidget should be shown. This is achieved by setting the widget mode according to the selected value.

Let's have a close look at the condition:
```
#{(empty value.conditionalOperator or value.conditionalOperator=='BETWEEN' or value.conditionalOperator=='NOT BETWEEN')?'edit':'hidden'}
```
In this expression, `value` references the value manipulated by the widget (e.g. the smart query instance). This variable is made available by the layout system. Here, if the conditional operator is not empty, and is different from 'BETWEEN' or 'NOT BETWEEN', the widget should be hidden. Otherwise, it can be shown in edit mode. The widgets shown when the conditional operator is empty should be suitable for the first operator within the list of available operators.

### Smart Folder Configuration

The smart folder creation and edition pages is very close to the smart search form. It reuses the same widget types, including some adjustments since the bound values are kept in its properties instead of a backing seam component. Its layout definition is here: [smart-folder-layouts-contrib.xml](https://github.com/nuxeo/nuxeo-platform-smart-search/blob/master/src/main/resources/OSGI-INF/smart-folder-layouts-contrib.xml). It also includes the definition of a widget in charge of displaying the content view results.

Note that it needs another content view to be defined (see [smart-folder-contentviews-contrib.xml](https://github.com/nuxeo/nuxeo-platform-smart-search/blob/master/src/main/resources/OSGI-INF/smart-folder-contentviews-contrib.xml)) so that this content view uses the query, sort information, result columns and page size as set on the document properties (note the usage of tags parameter, sortInfosBinding, resultColumns and pageSizeBinding).

![]({{file name='Smart-Search-results.png' space='userdoc' page='smart-search'}} ?w=650,border=true)

### Result Layout, Column and Sort Selection

The layout used to display the column selection, the sort information selection, and to display the search results, is the generic layout `document_listing_table`. If it is changed, it needs to be kept consistent between all the places referencing it:

*   the smart search form
*   the smart query content view result layout and result columns binding
*   the smart folder layout in edit mode
*   the smart folder content view result layout and result columns binding (displayed via its layout in view mode)
