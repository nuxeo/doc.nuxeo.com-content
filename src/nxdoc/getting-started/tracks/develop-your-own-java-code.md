---
title: 3 - Develop your own Java code
review:
    comment: ''
    date: '2021-03-02'
    status: ok
details:
    howto:
        excerpt: Learn how to start working with Nuxeo CLI.
        level: Intermediate
        tool: 'Nuxeo CLI, Nuxeo Studio'
        topics: 'Automation, Layout'
labels:
    - howto
    - nuxeo-cli
    - bchauvin
    - university
    - lts2016-ok
    - lts2017-ok
toc: true
tree_item_index: 300
history:
    -
        author: Florian BÃ©matol
        date: '2021-03-02 16:20'
        message: ''
        version: '78'
    -
        author: Thibaud Arguillere
        date: '2016-08-26 17:56'
        message: ''
        version: '77'
    -
        author: Solen Guitter
        date: '2016-07-21 08:52'
        message: Update link to SDK to use 8.3
        version: '76'
    -
        author: Manon Lumeau
        date: '2016-04-25 14:04'
        message: ''
        version: '75'
    -
        author: Solen Guitter
        date: '2016-04-18 17:41'
        message: Update FT SDK link to 8.2
        version: '74'
    -
        author: Bertrand Chauvin
        date: '2016-04-14 14:01'
        message: fix missing comment
        version: '73'
    -
        author: Bertrand Chauvin
        date: '2016-04-13 15:31'
        message: Added Studio project binding
        version: '72'
    -
        author: Bertrand Chauvin
        date: '2016-03-21 15:55'
        message: ''
        version: '71'
    -
        author: Bertrand Chauvin
        date: '2016-03-21 15:55'
        message: ''
        version: '70'
    -
        author: Bertrand Chauvin
        date: '2016-03-21 15:55'
        message: ''
        version: '69'
    -
        author: Solen Guitter
        date: '2016-03-21 15:34'
        message: Fix page layout
        version: '68'
    -
        author: Solen Guitter
        date: '2016-03-21 15:28'
        message: Fix screenshot max size and remove empty code block
        version: '67'
    -
        author: Bertrand Chauvin
        date: '2016-03-21 15:26'
        message: ''
        version: '66'
    -
        author: Bertrand Chauvin
        date: '2016-03-21 15:26'
        message: ''
        version: '65'
    -
        author: Bertrand Chauvin
        date: '2016-03-21 15:25'
        message: fix image size
        version: '64'
    -
        author: Bertrand Chauvin
        date: '2016-03-21 15:23'
        message: ''
        version: '63'
    -
        author: Bertrand Chauvin
        date: '2016-03-21 15:18'
        message: fix link
        version: '62'
    -
        author: Bertrand Chauvin
        date: '2016-03-21 15:16'
        message: fix anchor
        version: '61'
    -
        author: Bertrand Chauvin
        date: '2016-03-21 15:14'
        message: Replace with generator version
        version: '60'
    -
        author: Solen Guitter
        date: '2016-02-01 15:38'
        message: Update SDK download link to point to 8.1 SDK
        version: '59'
    -
        author: Bertrand Chauvin
        date: '2016-01-07 11:26'
        message: Add imports and package declaration in final result
        version: '58'
    -
        author: Bertrand Chauvin
        date: '2016-01-07 11:14'
        message: Fix parent version for parent POM
        version: '57'
    -
        author: Bertrand Chauvin
        date: '2016-01-05 15:08'
        message: Fix SDK link
        version: '56'
    -
        author: Bertrand Chauvin
        date: '2015-12-30 14:45'
        message: ''
        version: '55'
    -
        author: Bertrand Chauvin
        date: '2015-12-30 14:43'
        message: Update to LTS 2015 SDK
        version: '54'
    -
        author: Manon Lumeau
        date: '2015-11-30 17:11'
        message: ''
        version: '53'
    -
        author: Bertrand Chauvin
        date: '2015-11-04 13:42'
        message: Fixed typos
        version: '52'
    -
        author: Bertrand Chauvin
        date: '2015-11-04 13:28'
        message: typo
        version: '51'
    -
        author: Bertrand Chauvin
        date: '2015-11-04 13:26'
        message: typo
        version: '50'
    -
        author: Bertrand Chauvin
        date: '2015-11-04 13:25'
        message: ''
        version: '49'
    -
        author: Bertrand Chauvin
        date: '2015-11-04 13:23'
        message: Updated intro
        version: '48'
    -
        author: Bertrand Chauvin
        date: '2015-11-04 11:21'
        message: Complete / Fix / Refactor doc
        version: '47'
    -
        author: Bertrand Chauvin
        date: '2015-11-04 10:44'
        message: Complete doc until step 3
        version: '46'
    -
        author: Bertrand Chauvin
        date: '2015-11-04 10:24'
        message: Rename step
        version: '45'
    -
        author: Bertrand Chauvin
        date: '2015-11-04 10:23'
        message: Update SDK link
        version: '44'
    -
        author: Bertrand Chauvin
        date: '2015-11-04 10:22'
        message: Update prerequisites
        version: '43'
    -
        author: Julien Carsique
        date: '2015-10-29 13:56'
        message: update site URLs
        version: '42'
    -
        author: Solen Guitter
        date: '2015-10-14 09:00'
        message: Fix anchors and page layout
        version: '41'
    -
        author: Manon Lumeau
        date: '2015-09-25 13:32'
        message: ''
        version: '40'
    -
        author: Manon Lumeau
        date: '2015-09-25 13:30'
        message: ''
        version: '39'
    -
        author: Solen Guitter
        date: '2015-08-03 07:37'
        message: ''
        version: '38'
    -
        author: Manon Lumeau
        date: '2015-07-31 13:59'
        message: ''
        version: '37'
    -
        author: Solen Guitter
        date: '2015-07-21 09:19'
        message: ''
        version: '36'
    -
        author: Bertrand Chauvin
        date: '2015-05-25 08:07'
        message: Updated Nuxeo SDK version to HF12
        version: '35'
    -
        author: Manon Lumeau
        date: '2014-12-29 14:29'
        message: ''
        version: '34'
    -
        author: Manon Lumeau
        date: '2014-12-29 14:27'
        message: ''
        version: '33'
    -
        author: Manon Lumeau
        date: '2014-12-29 14:24'
        message: ''
        version: '32'
    -
        author: Solen Guitter
        date: '2014-12-26 14:05'
        message: ''
        version: '31'
    -
        author: Solen Guitter
        date: '2014-12-26 13:42'
        message: 'Add link to previous step, typos'
        version: '30'
    -
        author: Manon Lumeau
        date: '2014-12-24 14:50'
        message: ''
        version: '29'
    -
        author: Manon Lumeau
        date: '2014-12-24 14:47'
        message: ''
        version: '28'
    -
        author: Manon Lumeau
        date: '2014-12-24 14:46'
        message: ''
        version: '27'
    -
        author: Manon Lumeau
        date: '2014-12-24 14:45'
        message: ''
        version: '26'
    -
        author: Manon Lumeau
        date: '2014-12-24 14:42'
        message: ''
        version: '25'
    -
        author: Manon Lumeau
        date: '2014-12-24 14:34'
        message: ''
        version: '24'
    -
        author: Manon Lumeau
        date: '2014-12-24 14:32'
        message: ''
        version: '23'
    -
        author: Manon Lumeau
        date: '2014-12-24 14:13'
        message: ''
        version: '22'
    -
        author: Manon Lumeau
        date: '2014-12-24 13:56'
        message: ''
        version: '21'
    -
        author: Manon Lumeau
        date: '2014-12-24 13:44'
        message: ''
        version: '20'
    -
        author: Manon Lumeau
        date: '2014-12-24 13:27'
        message: ''
        version: '19'
    -
        author: Manon Lumeau
        date: '2014-12-24 13:17'
        message: ''
        version: '18'
    -
        author: Manon Lumeau
        date: '2014-12-24 11:12'
        message: ''
        version: '17'
    -
        author: Manon Lumeau
        date: '2014-12-24 11:07'
        message: ''
        version: '16'
    -
        author: Manon Lumeau
        date: '2014-12-24 10:56'
        message: ''
        version: '15'
    -
        author: Manon Lumeau
        date: '2014-12-22 16:59'
        message: ''
        version: '14'
    -
        author: Vladimir Pasquier
        date: '2014-12-20 17:38'
        message: ''
        version: '13'
    -
        author: Anne Jubert
        date: '2014-11-25 15:29'
        message: ''
        version: '12'
    -
        author: Manon Lumeau
        date: '2014-11-25 14:53'
        message: ''
        version: '11'
    -
        author: Manon Lumeau
        date: '2014-11-17 14:33'
        message: ''
        version: '10'
    -
        author: Manon Lumeau
        date: '2014-11-17 14:32'
        message: ''
        version: '9'
    -
        author: Manon Lumeau
        date: '2014-11-17 14:31'
        message: ''
        version: '8'
    -
        author: Manon Lumeau
        date: '2014-11-17 14:27'
        message: ''
        version: '7'
    -
        author: Manon Lumeau
        date: '2014-11-07 10:59'
        message: ''
        version: '6'
    -
        author: Manon Lumeau
        date: '2014-11-07 10:59'
        message: ''
        version: '5'
    -
        author: Manon Lumeau
        date: '2014-11-06 12:29'
        message: ''
        version: '4'
    -
        author: Manon Lumeau
        date: '2014-11-06 12:28'
        message: ''
        version: '3'
    -
        author: Manon Lumeau
        date: '2014-11-06 12:26'
        message: ''
        version: '2'
    -
        author: Manon Lumeau
        date: '2014-11-06 12:25'
        message: ''
        version: '1'  
---

Here we want to add some server side Java logic that will update the contract's renegotiation date. In our example it will simply take the contract's start date and add three months to it, but you can think of integrating any custom logic in your Java class, including a connection to an external webservice or an ERP.

{{#> callout type='info'}}
Watch the related courses on Nuxeo University
- [Course on Nuxeo CLI](https://university.nuxeo.com/learn/public/course/view/elearning/83/NuxeoDevTools)
- [Course on Nuxeo Platform Developer Basics](https://university.nuxeo.com/learn/public/course/view/elearning/11/nuxeo-platform-developer-basics).
- [Expert Session on Nuxeo Software Factory](https://university.nuxeo.com/learn/public/course/view/elearning/136/expert-session-nuxeo-software-factory)
![]({{file name='university-nuxeo-cli.png' version='cloud' space='nxdoc' page='university'}} ?w=450,border=true)
{{/callout}}

## Prerequisites

* A Contract document type created on this [page]({{page version='' space='nxdoc' page='web-ui-document-layouts'}})
* An IDE that integrates with Maven.
    We provide instructions for [Eclipse IDE for Java EE Developers](http://www.eclipse.org/downloads) 4.5 (Mars) or IntelliJ IDEA
* Java 11 with JDK
* Maven 3.3+ (see the Installing Maven section of page [Maven Usage]({{page version='' space='corg' page='maven-usage'}}))
* The latest stable [NodeJS](https://nodejs.org) version should be installed on your machine
* npm 2.12.0+


## Step 1 - Install Nuxeo CLI

From a command line prompt, type:

```bash
$ npm install -g nuxeo-cli
```

[Nuxeo CLI]({{page page='nuxeo-cli'}}) lets you easily scaffold common Nuxeo components like empty projects, Packages, Automation Operations, Services, etc. This saves you time writing boilerplate code to focus on your code instead of the structure.

We'll use it to generate a new Nuxeo project and a custom operation.

## Step 2 - Bootstrap your project

From a command line:

1.  Create an empty folder in which to store the project:

  ```bash
  $ mkdir contract-mgt-project
  $ cd contract-mgt-project
  ```

2.  Generate an "Multi module" project structure:

  ```bash
  $ nuxeo bootstrap
  ```

3.  Fill in the following values, via the prompts provided by Nuxeo CLI:

    ```
    ? Nuxeo Version: 2021.1
    ? Project Group id: com.bigcorp.contractmgt
    ? Project Artifact id: contract-mgt-project-parent
    ? Project Version: 1.0-SNAPSHOT
    ? Project Description: Contract management parent.
    ```

    Once complete, Nuxeo CLI will automatically start the process to create a "Single Module" project (the operation will be implemented here).

4.  Fill in the following values to generate the "Single Module" project:
  
    ```
    ? Project Group id: com.bigcorp.contractmgt
    ? Project Artifact id: contract-mgt-project-core
    ? Project version: 1.0-SNAPSHOT
    ? Project description: Contract management project.
    ```

    Now that the project is generated, it can be used in **any IDE**.

## Step 3 - Link with Studio

From a command line, inside your project directory:

1. Link your created project to your Studio project:

  ```bash
  $ nuxeo studio link
  ```

2. Fill in your credentials:

  ```
  ? NOS Username:
  ? NOS Token: [input is hidden]
  ? Studio Project:
  ? Do you want to update your Maven settings.xml file accordingly? (Y/n) Y
  ```

##### Encrypt your password

It is strongly recommended that you encrypt your Studio password (aka your Nuxeo Connect account password):

1. Create a master password:

  ```bash
  $ mvn --encrypt-master-password
  ```
  
  The command will prompt you for your master password and produce an encrypted version, something like this:
  
  ```bash
  {jSMOWnoPFgsHVpMvz5VrIt5kRbzGpI8u+9EF1iFQyJQ=}
  ```

2. Store this password in `~/.m2/settings-security.xml` like this:

  ```xml
  <settingsSecurity>
      <master>{jSMOWnoPFgsHVpMvz5VrIt5kRbzGpI8u+9EF1iFQyJQ=}</master>
  </settingsSecurity>
  ```

3. Encrypt your Studio password:

  ```bash
  $ mvn --encrypt-password
  ```

4. Store the encrypted Studio password in your `~/.m2/settings.xml` file as below:
   
```xml
  <servers>
    ....
    <server>
        <id>nuxeo-studio</id>
        <username>your_studio_username</username>
        <password>your_encrypted_studio_password</password>
    </server>
    ...
  </servers>
```

This configures your Maven client to use authentication when accessing the Studio Maven repository.

##### Import Studio constants

1. Import constants used in your Studio project:

  ```bash
  $ nuxeo studio import
  ```

2. Fill in the following values:

  ```bash
  ? Constant package: com.nuxeo.studio
  ? Constant class name: StudioConstant
  ```

Nuxeo CLI generates a new Java class with a list of constants containing everything defined in your Studio application.  
By default, the Java class is created to `contract-mgt-project/contract-mgt-project-core/src/main/java/com/nuxeo/studio/StudioConstant.java`.

## Step 4 - Implement your Operation

We want to create an operation that indicates the date of renegotiation of a contract. This will be done by fetching the document's start date and adding three months to it.

A custom operation is a Java class in which you can put custom business logic. Custom operations usually serve one of two purposes: to support business logic that is too complex to express via an Automation Chain; or to provide functionality that does not exist within existing operations.

Once created, the operation can be exposed in Nuxeo Studio and used just like any other operation via automation chains and automation scripts. See the [Automation]({{page page='automation'}}) section for more information about operations.

1. In your terminal, generate an operation code template:

  ```bash
  $ nuxeo bootstrap operation
  ```

2. You are prompted for a few details:

  ```
  ? Operation package: com.bigcorp.contractmgt
  ? Operation class name: ContractUpdater
  ? Operation label: Contract Updater
  ```

3. Nuxeo CLI will generate a new Java class for the operation at `contract-mgt-project/contract-mgt-project-core/src/main/java/com/bigcorp/contractmgt/ContractUpdater.java` like so:

  ```java
  package com.bigcorp.contractmgt;
  
  import org.apache.commons.lang3.StringUtils;
  import org.nuxeo.ecm.automation.core.Constants;
  import org.nuxeo.ecm.automation.core.annotations.Context;
  import org.nuxeo.ecm.automation.core.annotations.Operation;
  import org.nuxeo.ecm.automation.core.annotations.OperationMethod;
  import org.nuxeo.ecm.automation.core.annotations.Param;
  import org.nuxeo.ecm.core.api.CoreSession;
  import org.nuxeo.ecm.core.api.DocumentModel;
  import org.nuxeo.ecm.core.api.PathRef;
  
  /**
   *
   */
  @Operation(id=ContractUpdater.ID, category=Constants.CAT_DOCUMENT, label="Contract Updater", description="Describe here what your operation does.")
  public class ContractUpdater {
      public static final String ID = "Document.ContractUpdater";
      @Context
      protected CoreSession session;
      @Param(name = "path", required = false)
      protected String path;
      @OperationMethod
      public DocumentModel run() {
          if (StringUtils.isBlank(path)) {
              return session.getRootDocument();
          } else {
              return session.getDocument(new PathRef(path));
          }
      }
  }
  ```

3. Time to fill in the skeleton and start coding! Here is the final result of `ContractUpdater.java`:

  ```java
  package com.bigcorp.contractmgt;
  
  import java.util.Calendar;
  import org.nuxeo.ecm.automation.core.Constants;
  import org.nuxeo.ecm.automation.core.annotations.Operation;
  import org.nuxeo.ecm.automation.core.annotations.OperationMethod;
  import org.nuxeo.ecm.automation.core.collectors.DocumentModelCollector;
  import org.nuxeo.ecm.core.api.DocumentModel;
  import org.nuxeo.ecm.core.api.NuxeoException;
  import com.nuxeo.studio.StudioConstant;
  
  /**
   *
   */
  @Operation(id = ContractUpdater.ID, category = Constants.CAT_DOCUMENT, label = "Contract Updater", description = "On a contract, sets the reminder date to three months after its start date.")
  public class ContractUpdater {
  
      public static final String ID = "Document.ContractUpdater";

      @OperationMethod(collector = DocumentModelCollector.class)
      public DocumentModel run(DocumentModel input) throws NuxeoException {
          if (!(StudioConstant.CONTRACT_DOC_TYPE.equals(input.getType()))) {
              throw new NuxeoException("Operation works only with "
                      + StudioConstant.CONTRACT_DOC_TYPE + " document type.");
          }
  
          Calendar start = (Calendar) input.getPropertyValue(StudioConstant.CONTRACT_SCHEMA_START_PROPERTY);
          Calendar reminder = (Calendar) start.clone();
          reminder.add(Calendar.MONTH, 3);
          input.setPropertyValue(StudioConstant.CONTRACT_SCHEMA_REMINDER_PROPERTY, reminder.getTime());
          return input;
      }
  }
  ```
    
## Step 5 - Export registries and use them in Studio

We want to make visible what is defined in our Java code into the Studio project. For instance, we'll be able to use `Document.ContractUpdater` in an Automation Chain.

1. In your terminal, export your work:

   ```bash
   $ nuxeo studio export
   ```

2. On your Studio project under **Settings** > **Automatic Registries** > **Automation Operations**, you should see:
   ![]({{file name='OperationExport1.png' page='develop-your-own-java-code'}} ?w=450,border=true)
   
3. Your operation can be used in **Configuration** > **Automation** > **Automations Chains**, as follow:
   ![]({{file name='OperationExport2.png' page='develop-your-own-java-code'}} ?w=450,border=true)

## Step 6 - Unit testing

The code can either be tested through unit tests or manually. You need to bind the Studio project first to have it deployed during the unit tests or on the server when testing manually.

### Update the Unit Test

Nuxeo CLI automatically created a unit test class for the Operation at `contract-mgt-project/contract-mgt-project-core/src/test/java/com/bigcorp/contractmgt/TestContractUpdater.java`. This test must be made to pass in order to compile and deploy your project.

1.  Replace `TestContractUpdater.java` with the following code:

    ```java
    package com.bigcorp.contractmgt;

    import static org.junit.Assert.assertEquals;
    import static org.junit.Assert.assertNotNull;
    import static org.junit.Assert.assertNull;

    import java.util.Calendar;
    import java.util.GregorianCalendar;
    import javax.inject.Inject;

    import org.junit.Test;
    import org.junit.runner.RunWith;
    import org.nuxeo.ecm.automation.test.AutomationFeature;
    import org.nuxeo.ecm.core.api.CoreSession;
    import org.nuxeo.ecm.core.api.DocumentModel;
    import org.nuxeo.ecm.core.test.DefaultRepositoryInit;
    import org.nuxeo.ecm.core.test.annotations.Granularity;
    import org.nuxeo.ecm.core.test.annotations.RepositoryConfig;
    import org.nuxeo.runtime.test.runner.Deploy;
    import org.nuxeo.runtime.test.runner.Features;
    import org.nuxeo.runtime.test.runner.FeaturesRunner;
    import org.nuxeo.runtime.test.runner.PartialDeploy;
    import org.nuxeo.runtime.test.runner.TargetExtensions;

    @RunWith(FeaturesRunner.class)
    @Features(AutomationFeature.class)
    @RepositoryConfig(init = DefaultRepositoryInit.class, cleanup = Granularity.METHOD)

    // Be sure to replace studio.extensions.MAVEN-ARTIFACT-ID
    // with your Studio project's symbolic name.
    // You can find it in Studio:
    // Settings > Application Information > Maven Artifact id field
    @Deploy({"com.bigcorp.contractmgt.contract-mgt-project-core"})
    @PartialDeploy(bundle = "studio.extensions.MAVEN-ARTIFACT-ID", features = { TargetExtensions.Automation.class })
    public class TestContractUpdater {
          @Inject
          protected CoreSession session;
          @Test
          public void shouldCallTheAutomationChain() {
              // Create a contract, currently stored in memory
              DocumentModel doc = session.createDocumentModel("/default-domain", "my-test-doc", ContractUpdater.CONTRACT_TYPE);
              GregorianCalendar now = new GregorianCalendar();
              doc.setPropertyValue(ContractUpdater.CONTRACT_START, now);

              // At this stage, the reminder date should be empty
              assertNull(doc.getPropertyValue(ContractUpdater.CONTRACT_REMINDER));

              // We'll save the document in the database which will
              // trigger an event handler that sets the reminder date
              doc = session.createDocument(doc);
              session.save();

              // Now we'll check that the reminder date is set as expected
              int currentMonth = now.get(Calendar.MONTH);
              GregorianCalendar reminder = (GregorianCalendar) doc.getPropertyValue(ContractUpdater.CONTRACT_REMINDER);
              assertNotNull("Reminder date is not set, check your automation chain.", reminder);
              assertEquals("Reminder date is not set in three months from now", (((currentMonth + 3) > 12) ? (currentMonth - 9):(currentMonth + 3)), reminder.get(Calendar.MONTH));
          }
    }
    ```
    
## What do next 

You should learn to [package, publish, deploy and hotreload](https://doc.nuxeo.com/nxdoc/cloud/package-publish-deploy-hotreload/) your studio project.
